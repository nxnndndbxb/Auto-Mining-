
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CDNC Coin Airdrop | The Future of Crypto</title>
    <!-- Google Fonts: Poppins -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        /* --- [V12] Aurora Borealis Theme --- */
        :root {
            /* Core Palette */
            --background-primary: #0a0c1e;   /* Deep space blue */
            --background-secondary: #12182e; /* Slightly lighter space blue */
            --text-primary: #e0f7fa;         /* Light cyan, like stars */
            --text-secondary: rgba(224, 247, 250, 0.65); /* Faded starlight */
            
            /* Accents */
            --primary-accent: #4dd0e1;       /* Vibrant Cyan */
            --secondary-accent: #8e24aa;     /* Deep Purple */
            --tertiary-accent: #d81b60;      /* Vibrant Magenta */
            --text-on-accent: #0a0c1e;       /* Text color for light buttons */
            
            /* Functional Colors */
            --success-color: #4caf50;        /* Bright Green */
            --danger-color: #f44336;         /* Bright Red */
            --warning-color: #ff9800;        /* Bright Orange */
            
            /* Surface & Layering */
            --surface-bg: rgba(29, 39, 71, 0.55); /* Translucent Frosted Indigo Glass */
            --surface-border: rgba(77, 208, 225, 0.2); /* Faint Cyan */
            --surface-highlight: rgba(77, 208, 225, 0.1);
            
            /* General */
            --font-family: 'Poppins', sans-serif;
            --border-radius: 22px;
            --transition-speed: 0.4s;
        }

        /* --- General & Body Styling --- */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; }

        body {
            font-family: var(--font-family);
            background-color: var(--background-primary);
            color: var(--text-primary);
            padding-bottom: 120px;
            overflow-x: hidden;
            position: relative;
        }

        /* --- Animated Backgrounds --- */
        #background-effects { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -2; overflow: hidden; background-color: var(--background-primary); }
        .aurora-background { position: absolute; width: 200%; height: 200%; top: -50%; left: -50%; background: radial-gradient(ellipse at 20% 25%, hsla(190, 80%, 60%, 0.2), transparent 50%), radial-gradient(ellipse at 80% 75%, hsla(280, 70%, 50%, 0.25), transparent 60%); animation: aurora-flow 25s infinite alternate ease-in-out; }
        @keyframes aurora-flow { from { transform: rotate(0deg) scale(1.2); } to { transform: rotate(20deg) scale(1.2); } }
        #particles-js { position: fixed; width: 100%; height: 100%; top: 0; left: 0; z-index: -1; }

        /* --- Preloader --- */
        #preloader { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: var(--background-primary); display: flex; justify-content: center; align-items: center; z-index: 9999; transition: opacity 0.5s ease, visibility 0.5s ease; }
        #preloader.hidden { opacity: 0; visibility: hidden; }
        .spinner { width: 60px; height: 60px; border-radius: 50%; border: 4px solid rgba(77, 208, 225, 0.2); border-top-color: var(--primary-accent); animation: spin-loader 1s linear infinite; }
        @keyframes spin-loader { to { transform: rotate(360deg); } }

        /* --- Main App Containers & Page Transitions --- */
        .page { display: none; padding: 20px; animation: pageFadeIn 0.8s cubic-bezier(0.165, 0.84, 0.44, 1); min-height: calc(100vh - 120px); }
        .page.active { display: block; }
        @keyframes pageFadeIn { from { opacity: 0; transform: translateY(30px) scale(0.98); } to { opacity: 1; transform: translateY(0) scale(1); } }
        .page-header { display: flex; align-items: center; margin-bottom: 25px; }
        .page-header .back-btn { background: none; border: none; font-size: 1.5em; color: var(--primary-accent); cursor: pointer; margin-right: 15px; }
        .page-header h3 { flex-grow: 1; }
        
        /* --- Content Panel Component --- */
        .content-panel { background: var(--surface-bg); border: 1px solid var(--surface-border); border-radius: var(--border-radius); padding: 30px; backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); box-shadow: 0 10px 50px rgba(0, 0, 0, 0.4), 0 0 20px var(--surface-highlight); margin-bottom: 25px; position: relative; overflow: hidden; transition: transform var(--transition-speed) ease, box-shadow var(--transition-speed) ease; }
        .content-panel:hover { transform: translateY(-5px); box-shadow: 0 15px 60px rgba(0, 0, 0, 0.5), 0 0 30px var(--surface-highlight); }
        .content-panel h3 { font-weight: 700; font-size: 1.5em; background: linear-gradient(90deg, var(--text-primary), var(--primary-accent)); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 25px; padding-bottom: 15px; border-bottom: 1px solid var(--surface-border); }

        /* --- Auth Pages --- */
        #auth-container { display: none; flex-direction: column; justify-content: center; align-items: center; min-height: 100vh; padding: 20px; }
        #auth-container.active { display: flex; }
        .auth-form { width: 100%; max-width: 420px; }
        .auth-icon { font-size: 5em; color: var(--primary-accent); text-shadow: 0 0 25px hsla(187, 76%, 62%, 0.5); margin-bottom: 30px; animation: auth-icon-float 6s ease-in-out infinite; text-align: center; }
        @keyframes auth-icon-float { 0%, 100% { transform: translateY(0); text-shadow: 0 0 25px hsla(187, 76%, 62%, 0.5); } 50% { transform: translateY(-15px); text-shadow: 0 0 40px hsla(187, 76%, 62%, 0.8); } }
        .auth-form h2 { text-align: center; font-weight: 800; font-size: 3em; margin-bottom: 30px; background: linear-gradient(90deg, var(--text-primary), var(--primary-accent)); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; text-shadow: 0 1px 2px rgba(0,0,0,0.5); }
        .input-group { position: relative; margin-bottom: 25px; }
        .input-group i.fa-solid { position: absolute; left: 20px; top: 50%; transform: translateY(-50%); color: var(--text-secondary); transition: color var(--transition-speed) ease; }
        .input-group .toggle-password { left: auto; right: 20px; cursor: pointer; }
        .input-group input { width: 100%; padding: 18px 20px 18px 55px; border: 1px solid var(--surface-border); border-radius: 16px; background-color: rgba(0,0,0,0.4); color: var(--text-primary); font-family: var(--font-family); font-size: 1em; transition: all var(--transition-speed) ease; }
        .input-group input::placeholder { color: var(--text-secondary); opacity: 0.8; }
        .input-group input:focus { outline: none; border-color: var(--primary-accent); box-shadow: 0 0 20px hsla(187, 76%, 62%, 0.4); background-color: rgba(0,0,0,0.5); }
        .input-group input:focus ~ i.fa-solid { color: var(--primary-accent); }
        .btn { display: flex; justify-content: center; align-items: center; width: 100%; padding: 18px; border: none; border-radius: 16px; color: var(--text-on-accent); background: linear-gradient(45deg, var(--primary-accent), var(--secondary-accent)); font-size: 1.1em; font-weight: 700; cursor: pointer; transition: all var(--transition-speed) cubic-bezier(0.165, 0.84, 0.44, 1); position: relative; overflow: hidden; box-shadow: 0 8px 30px -8px hsla(284, 76%, 40%, 0.4); text-transform: uppercase; letter-spacing: 0.5px; }
        .btn:hover:not(:disabled) { transform: translateY(-5px) scale(1.02); box-shadow: 0 12px 35px -8px hsla(187, 76%, 62%, 0.5); background-position: 100% 0; }
        .btn:disabled { opacity: 0.6; cursor: not-allowed; transform: translateY(0); box-shadow: none; background: var(--text-secondary); }
        .btn .btn-text { transition: opacity 0.2s ease; }
        .btn .spinner-sm { position: absolute; width: 24px; height: 24px; border: 3px solid rgba(0,0,0,0.3); border-top-color: var(--text-on-accent); border-radius: 50%; animation: spin-loader 0.8s linear infinite; opacity: 0; transition: opacity 0.2s ease; }
        .btn.loading .btn-text { opacity: 0; }
        .btn.loading .spinner-sm { opacity: 1; }
        .auth-switch { text-align: center; margin-top: 25px; color: var(--text-secondary); }
        .auth-switch a { color: var(--primary-accent); text-decoration: none; font-weight: 600; }
        #app-container { display: none; }
        #app-container.active { display: block; }

        /* --- Bottom Navigation Bar --- */
        .bottom-nav { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); width: calc(100% - 40px); max-width: 500px; height: 80px; background: var(--surface-bg); border: 1px solid var(--surface-border); backdrop-filter: blur(25px); -webkit-backdrop-filter: blur(25px); display: flex; justify-content: space-around; align-items: center; border-radius: var(--border-radius); box-shadow: 0 15px 50px rgba(0, 0, 0, 0.5); z-index: 1000; }
        .nav-btn { background: none; border: none; color: var(--text-secondary); display: flex; flex-direction: column; align-items: center; font-size: 0.75em; font-weight: 500; cursor: pointer; transition: all var(--transition-speed) ease; position: relative; padding: 10px; width: 65px; }
        .nav-btn i { font-size: 2em; margin-bottom: 6px; }
        .nav-btn.active { color: var(--text-primary); transform: translateY(-5px); }
        .nav-btn.active i { color: var(--primary-accent); }
        .nav-btn::before { content: ''; position: absolute; bottom: -5px; width: 8px; height: 8px; background-color: var(--primary-accent); border-radius: 50%; transform: scale(0); transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); box-shadow: 0 0 10px var(--primary-accent), 0 0 20px var(--primary-accent); }
        .nav-btn.active::before { transform: scale(1); }

        /* --- Draggable Floating Telegram Button --- */
        .telegram-fab { position: fixed; bottom: 110px; right: 25px; width: 60px; height: 60px; background: linear-gradient(45deg, #2AABEE, #229ED9); color: #fff; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 1.8em; text-decoration: none; box-shadow: 0 8px 25px rgba(34, 158, 217, 0.4); z-index: 1001; transition: transform 0.3s ease, box-shadow 0.3s ease; user-select: none; -webkit-user-select: none; cursor: grab; transform: scale(0); animation: fab-pop-in 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) 1.5s forwards; }
        .telegram-fab.dragging { cursor: grabbing; transition: none; box-shadow: 0 12px 30px rgba(34, 158, 217, 0.6); }
        .telegram-fab:hover:not(.dragging) { transform: scale(1.1); box-shadow: 0 12px 30px rgba(34, 158, 217, 0.6); }
        @keyframes fab-pop-in { from { transform: scale(0); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        /* --- Home Page --- */
        .header-welcome { text-align: center; margin-bottom: 20px; }
        .header-welcome h2 { font-size: 2.2em; font-weight: 700; line-height: 1.2; color: var(--text-primary)}
        .header-welcome p { color: var(--text-secondary); font-weight: 300; font-size: 1.1em; }

        /* --- Mining Hub Styles --- */
        #mining-hub-idle { text-align: center; }
        #mining-hub-idle .icon { font-size: 4em; color: var(--primary-accent); margin-bottom: 15px; text-shadow: 0 0 15px hsla(187, 76%, 62%, 0.4); }
        #mining-hub-idle p { font-size: 1.1em; color: var(--text-secondary); margin-bottom: 25px; line-height: 1.7; }
        #mining-hub-active { display: none; }
        .mining-machine-container { position: relative; display: flex; justify-content: center; align-items: center; margin-bottom: 30px; min-height: 220px; }
        .mining-rig { position: relative; width: 200px; height: 200px; display: flex; justify-content: center; align-items: center; }
        .rig-ring { position: absolute; border-radius: 50%; border-style: solid; }
        .rig-ring-1 { width: 200px; height: 200px; border-width: 2px; opacity: 0.3; border-color: var(--secondary-accent); animation: spin-clockwise 20s linear infinite; }
        .rig-ring-2 { width: 170px; height: 170px; border-width: 4px; border-style: dotted; border-color: var(--primary-accent); opacity: 0.5; animation: spin-counter-clockwise 15s linear infinite; }
        .rig-ring-3 { width: 140px; height: 140px; border-width: 1px; border-top-color: var(--primary-accent); border-bottom-color: var(--primary-accent); border-left-color: transparent; border-right-color: transparent; opacity: 0.8; box-shadow: 0 0 15px hsla(187, 76%, 62%, 0.4), 0 0 25px rgba(0,0,0,0.3); animation: spin-clockwise 10s linear infinite; }
        .rig-core { width: 100px; height: 100px; background: radial-gradient(ellipse, hsla(187, 76%, 62%, 0.2) 0%, hsla(249, 64%, 6%, 0.4) 40%, transparent 70%); border-radius: 50%; display: flex; justify-content: center; align-items: center; position: relative; animation: core-pulse-glow 4s ease-in-out infinite; }
        .rig-core::before { content: ''; position: absolute; width: 100%; height: 100%; background: radial-gradient(ellipse, var(--primary-accent) 0%, transparent 70%); opacity: 0.1; border-radius: 50%; animation: core-flare 4s ease-in-out infinite; animation-delay: 1s; }
        .rig-core i { font-size: 3.5em; color: var(--primary-accent); text-shadow: 0 0 10px var(--primary-accent), 0 0 20px hsla(187, 76%, 62%, 0.5), 0 0 30px hsla(187, 76%, 62%, 0.3); animation: icon-flicker 4s ease-in-out infinite; }
        @keyframes spin-clockwise { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        @keyframes spin-counter-clockwise { from { transform: rotate(360deg); } to { transform: rotate(0deg); } }
        @keyframes core-pulse-glow { 0%, 100% { transform: scale(0.95); box-shadow: 0 0 20px 5px hsla(187, 76%, 62%, 0.25), inset 0 0 20px hsla(249, 64%, 6%, 0.5); } 50% { transform: scale(1); box-shadow: 0 0 40px 10px hsla(187, 76%, 62%, 0.45), inset 0 0 10px hsla(249, 64%, 6%, 0.3); } }
        @keyframes core-flare { 0%, 100% { transform: scale(1); opacity: 0.1; } 50% { transform: scale(1.2); opacity: 0.3; } }
        @keyframes icon-flicker { 0%, 100% { opacity: 1; transform: scale(1); } 50% { opacity: 0.8; transform: scale(0.98); } }
        .mining-stat { display: flex; justify-content: space-between; align-items: center; padding: 15px 0; border-bottom: 1px solid var(--surface-border); }
        .mining-stat:last-child { border-bottom: none; }
        .mining-stat .label { color: var(--text-secondary); font-size: 1em; }
        .mining-stat .value { font-size: 1.2em; font-weight: 600; color: var(--text-primary); }
        .mining-stat .value.profit { color: var(--success-color); animation: reward-pulse-green 2.5s ease-in-out infinite; }
        .mining-actions { display: flex; gap: 15px; margin-top: 25px; }
        .mining-actions .btn { flex: 1; }
        .btn-boost { background: linear-gradient(45deg, var(--secondary-accent), var(--tertiary-accent)); box-shadow: 0 0 25px hsla(338, 79%, 48%, 0.4); }

        /* --- General Stats, Trade, Wallet, etc. --- */
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .stat-card { background: var(--background-secondary); border-radius: 20px; padding: 25px; text-align: center; border: 1px solid var(--surface-border); transition: all var(--transition-speed) ease; }
        .stat-card:hover { border-color: var(--primary-accent); transform: scale(1.05) translateY(-5px); box-shadow: 0 8px 20px rgba(0,0,0,0.2), 0 0 15px hsla(187, 76%, 62%, 0.3); background: var(--surface-bg);}
        .stat-card .label { font-size: 0.9em; color: var(--text-secondary); margin-bottom: 10px; text-transform: uppercase; letter-spacing: 0.5px; }
        .stat-card .value { font-size: 1.6em; font-weight: 600; color: var(--text-primary); }
        .value, .amount { transition: color 0.5s ease; }
        .info-text { font-size: 0.9em; color: var(--text-secondary); text-align: center; margin-top: 15px; line-height: 1.6; }
        .balance-display { text-align: center; margin-bottom: 25px; }
        .balance-display .amount { font-size: 4em; font-weight: 700; line-height: 1.1; background: linear-gradient(90deg, #e0f7fa, #4dd0e1); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; text-shadow: 0 2px 15px hsla(187, 76%, 62%, 0.2); }
        .balance-display .currency { color: var(--text-secondary); font-weight: 400; font-size: 1.1em; }
        .balance-on-hold { text-align: center; color: var(--warning-color); font-size: 0.9em; margin-top: -15px; margin-bottom: 25px; font-weight: 600; }
        .trade-form input, .modal-content select { width: 100%; padding: 18px; border: 1px solid var(--surface-border); border-radius: 16px; background-color: rgba(0,0,0,0.3); color: var(--text-primary); font-size: 1em; margin-bottom: 20px; }
        .trade-form input::placeholder { color: var(--text-secondary); }
        .trade-actions, .wallet-actions { display: flex; gap: 20px; margin-top: 20px; }
        .trade-actions .btn, .wallet-actions .btn { flex: 1; }
        .btn-buy { background: linear-gradient(45deg, var(--success-color), #81c784); color: white; box-shadow: 0 0 25px hsla(122, 39%, 49%, 0.4); }
        .btn-sell { background: linear-gradient(45deg, var(--danger-color), #e57373); color: white; box-shadow: 0 0 25px hsla(4, 90%, 58%, 0.4); }
        #stake-page h3 { background: linear-gradient(90deg, #c5cae9, #e0f7fa); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; }
        .staking-overview { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; text-align: center; margin-bottom: 30px; }
        .staking-stat .label { color: var(--text-secondary); text-transform: uppercase; font-size: 0.8em; letter-spacing: 0.5px; margin-bottom: 8px; }
        .staking-stat .value { font-size: 1.8em; font-weight: 600; color: var(--text-primary); }
        #staked-balance-value { color: var(--primary-accent); }
        @keyframes reward-pulse-green { 0% { text-shadow: 0 0 5px hsla(122, 39%, 49%, 0.3); } 50% { text-shadow: 0 0 20px hsla(122, 39%, 49%, 0.7); } 100% { text-shadow: 0 0 5px hsla(122, 39%, 49%, 0.3); } }
        #staking-rewards-value { color: var(--success-color); animation: reward-pulse-green 2.5s ease-in-out infinite; }
        .btn-stake { background: linear-gradient(45deg, var(--primary-accent), var(--secondary-accent)); box-shadow: 0 0 25px hsla(187, 76%, 62%, 0.4); }
        .btn-claim { background: linear-gradient(45deg, var(--warning-color), #ffb74d); color: #fff; box-shadow: 0 0 25px hsla(36, 100%, 50%, 0.4); }
        #transaction-history-list, #invited-users-list { list-style-type: none; max-height: 400px; overflow-y: auto; padding-right: 10px; }
        .transaction-item { display: flex; align-items: center; padding: 15px; margin-bottom: 10px; background-color: rgba(0,0,0,0.25); border-radius: 12px; border-left: 4px solid var(--text-secondary); transition: background-color 0.3s ease; }
        .transaction-item:hover { background-color: rgba(0,0,0,0.4); }
        .transaction-item.buy, .transaction-item.deposit, .transaction-item.mining_profit, .transaction-item.stake_reward, .transaction-item.invite_bonus { border-left-color: var(--success-color); }
        .transaction-item.sell, .transaction-item.withdrawal { border-left-color: var(--danger-color); }
        .transaction-item.pending { border-left-color: var(--warning-color); opacity: 0.8; }
        .transaction-item.bonus, .transaction-item.stake, .transaction-item.unstake, .transaction-item.mining_invest { border-left-color: var(--primary-accent); }
        .transaction-item .icon { font-size: 1.5em; width: 40px; text-align: center; margin-right: 15px; }
        .transaction-item.buy .icon, .transaction-item.deposit .icon, .transaction-item.mining_profit .icon, .transaction-item.stake_reward .icon, .transaction-item.invite_bonus .icon { color: var(--success-color); }
        .transaction-item.sell .icon, .transaction-item.withdrawal .icon { color: var(--danger-color); }
        .transaction-item.stake .icon, .transaction-item.unstake .icon { color: var(--primary-accent); }
        .transaction-item.bonus .icon, .transaction-item.mining_invest .icon { color: var(--secondary-accent); }
        .transaction-item.pending .icon { color: var(--warning-color); }
        .transaction-item .details { flex-grow: 1; }
        .transaction-item .type { font-weight: 600; text-transform: capitalize; color: var(--text-primary); }
        .transaction-item .date { font-size: 0.8em; color: var(--text-secondary); }
        .transaction-item .amount { font-size: 1.1em; font-weight: 600; text-align: right; color: var(--text-primary); }

        /* --- Beautiful Profile Page --- */
        .profile-header { text-align: center; margin-bottom: 30px; }
        .profile-avatar { width: 100px; height: 100px; border-radius: 50%; background: linear-gradient(45deg, var(--primary-accent), var(--secondary-accent)); display: flex; justify-content: center; align-items: center; margin: 0 auto 20px; box-shadow: 0 0 30px hsla(187, 76%, 62%, 0.4); }
        .profile-avatar i { font-size: 3.5em; color: var(--background-primary); }
        .profile-header h2 { font-size: 1.8em; font-weight: 700; margin-bottom: 5px; }
        .profile-header p { color: var(--text-secondary); font-size: 1em; font-family: monospace; }
        .profile-actions-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .action-card { background-color: var(--surface-bg); border: 1px solid var(--surface-border); border-radius: var(--border-radius); padding: 20px; text-align: center; cursor: pointer; transition: all var(--transition-speed) ease; }
        .action-card:hover { transform: translateY(-5px); border-color: var(--primary-accent); box-shadow: 0 8px 20px rgba(0,0,0,0.3), 0 0 15px hsla(187, 76%, 62%, 0.2); }
        .action-card i { font-size: 2.2em; margin-bottom: 12px; }
        .action-card span { font-size: 1em; font-weight: 600; display: block; }
        .action-card.invite i { color: var(--tertiary-accent); }
        .action-card.rewards i { color: var(--warning-color); }
        .action-card.password i { color: var(--danger-color); }
        .action-card.free-mining i { color: var(--success-color); }
        .action-card.about i { color: var(--primary-accent); }
        .action-card.logout i { color: var(--text-secondary); }

        /* --- Invite Page --- */
        .invite-box { text-align: center; }
        .invite-box .icon { font-size: 4em; margin: 20px 0; color: var(--tertiary-accent); text-shadow: 0 0 20px hsla(338, 79%, 48%, 0.5);}
        .invite-box p { color: var(--text-secondary); line-height: 1.8; margin-bottom: 25px; font-size: 1.05em;}
        .invite-code { background-color: rgba(0,0,0,0.2); padding: 25px; border-radius: 16px; border: 1px dashed var(--surface-border); font-family: 'Courier New', Courier, monospace; font-size: 1.1em; margin: 25px 0; word-wrap: break-word; text-align: center; color: var(--primary-accent); font-weight: bold; }
        .bonus-display { text-align: center; margin-bottom: 30px; }
        .bonus-display .label { text-transform: uppercase; letter-spacing: 1px; font-size: 1em; color: var(--text-secondary); margin-bottom: 10px; }
        .bonus-display .amount { font-size: 3em; font-weight: 700; color: var(--success-color); animation: reward-pulse-green 2s infinite; }
        .level-item { display: flex; justify-content: space-between; align-items: center; padding: 18px 15px; background-color: rgba(0,0,0,0.15); border-radius: 14px; margin-bottom: 10px; border-left: 4px solid var(--secondary-accent); transition: background-color 0.3s ease; cursor: pointer; }
        .level-item:hover { background-color: rgba(0,0,0,0.25); }
        .level-item .level-name { font-weight: 600; font-size: 1.1em; }
        .level-item .level-count { font-weight: 700; font-size: 1.2em; color: var(--primary-accent); }
        .level-item .level-name .percent { font-size: 0.8em; color: var(--text-secondary); font-weight: 400; margin-left: 8px; }

        /* --- Rewards Page --- */
        .reward-item { display: flex; justify-content: space-between; align-items: center; gap: 15px; padding: 20px; background-color: rgba(0,0,0,0.2); border-radius: 16px; margin-bottom: 15px; border-left: 5px solid var(--warning-color); transition: all 0.3s ease; }
        .reward-item.claimed { border-left-color: var(--success-color); opacity: 0.7; }
        .reward-item.claimable { border-left-color: var(--primary-accent); box-shadow: 0 0 20px hsla(187, 76%, 62%, 0.3); }
        .reward-info h4 { font-size: 1.1em; margin-bottom: 5px; }
        .reward-info p { margin: 0; font-size: 0.9em; color: var(--text-secondary); }
        .reward-action .btn { width: auto; padding: 10px 20px; min-width: 120px; font-size: 0.9em; }
        .reward-action .reward-value { font-size: 1.3em; font-weight: 700; color: var(--success-color); margin-bottom: 8px; text-align: right; }
        
        /* --- About Us Page --- */
        .fbr-certificate { border: 10px solid #1a233f; padding: 25px; background: #e0f7fa; color: #0a0c1e; border-radius: 10px; text-align: center; margin-top: 30px; box-shadow: 0 0 20px rgba(0,0,0,0.5); font-family: 'Times New Roman', serif; }
        .fbr-certificate h4 { font-size: 1.8em; color: #8e24aa; letter-spacing: 2px; }
        .fbr-certificate p { font-size: 1.1em; line-height: 1.6; margin: 15px 0; }
        .fbr-certificate .seal { font-size: 4em; color: #b08d57; margin-top: 20px; }
        
        /* --- Daily Task Styles --- */
        .task-item { display: flex; justify-content: space-between; align-items: center; padding: 20px 0; border-bottom: 1px solid var(--surface-border); }
        .task-item:last-child { border-bottom: none; }
        .task-info h4 { font-weight: 600; margin-bottom: 4px; font-size: 1.1em; color: var(--text-primary); }
        .task-info .info-text { margin: 0; text-align: left; font-size: 0.9em; }
        .task-action { display: flex; flex-direction: column; align-items: flex-end; gap: 8px; text-align: right; }
        .task-action .reward-amount { font-weight: 700; color: var(--success-color); font-size: 1.1em; }
        .task-action .btn { width: auto; padding: 10px 20px; min-width: 120px; font-size: 0.9em; }
        .task-progress-details p { margin: 0; font-size: 0.85em; color: var(--text-secondary); font-weight: 500;}

        /* --- Modals, Toast, etc. (Mostly unchanged) --- */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(10, 12, 30, 0.7); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px); z-index: 2000; display: flex; justify-content: center; align-items: center; opacity: 0; pointer-events: none; transition: opacity var(--transition-speed) ease; }
        .modal-overlay.active { opacity: 1; pointer-events: all; }
        .modal-content { width: calc(100% - 40px); max-width: 450px; transform: scale(0.95) translateY(20px); transition: transform var(--transition-speed) cubic-bezier(0.165, 0.84, 0.44, 1); }
        .option-group { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 25px; background-color: rgba(0,0,0,0.3); padding: 6px; border-radius: 18px; }
        .option-btn { padding: 14px; border: none; background-color: transparent; color: var(--text-secondary); border-radius: 14px; cursor: pointer; transition: all 0.3s ease; font-weight: 600; }
        .option-btn.active { background: var(--primary-accent); color: var(--text-on-accent); box-shadow: 0 5px 15px hsla(187, 76%, 62%, 0.2); }
        .address-box { background-color: rgba(0,0,0,0.2); padding: 20px; border-radius: 16px; margin-bottom: 20px; word-wrap: break-word; display: flex; justify-content: space-between; align-items: center; border: 1px solid var(--surface-border); cursor: pointer; transition: border-color 0.3s ease, box-shadow 0.3s ease; }
        .address-box:hover { border-color: var(--primary-accent); }
        .address-box.copied { border-color: var(--success-color); box-shadow: 0 0 15px hsla(122, 39%, 49%, 0.4); }
        .address-box .address { flex: 1; margin-right: 15px; font-family: monospace; word-break: break-all; }
        .copy-btn { background: none; border: none; color: var(--primary-accent); cursor: pointer; font-size: 1.5em; transition: color 0.3s ease, transform 0.3s ease; }
        .copy-btn:hover { color: var(--text-primary); transform: scale(1.1); }
        .btn-subtle { background: none; border: 1px solid var(--surface-border); color: var(--text-secondary); box-shadow: none; text-transform: none; letter-spacing: 0; }
        .btn-subtle:hover { background: var(--surface-highlight); color: var(--text-primary); border-color: var(--primary-accent); }
        .modal-close-btn { position: absolute; top: 15px; right: 15px; background: rgba(255,255,255,0.05); border: none; color: var(--text-primary); width: 36px; height: 36px; border-radius: 50%; font-size: 1.2em; cursor: pointer; transition: background-color 0.3s ease; z-index: 10; }
        .modal-close-btn:hover { background-color: rgba(255,255,255,0.1); }
        #toast-container { position: fixed; top: 20px; right: 20px; z-index: 9999; }
        .toast { background: var(--surface-bg); border-left: 5px solid var(--primary-accent); border-radius: 12px; padding: 18px 25px; box-shadow: 0 8px 25px rgba(0,0,0,0.5); color: var(--text-primary); margin-bottom: 10px; opacity: 0; transform: translateX(100%); animation: toastIn 0.5s cubic-bezier(0.165, 0.84, 0.44, 1) forwards; min-width: 300px; backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px); }
        @keyframes toastIn { to { opacity: 1; transform: translateX(0); } }
        .toast.success { border-left-color: var(--success-color); }
        .toast.danger { border-left-color: var(--danger-color); }
        .toast.info { border-left-color: var(--secondary-accent); }

        /* Responsive adjustments */
        @media (max-width: 480px) {
            .content-panel { padding: 25px 20px; }
            .content-panel h3 { margin-bottom: 20px; padding-bottom: 10px; font-size: 1.3em; }
            .auth-form h2 { font-size: 2.5em; }
            .balance-display .amount { font-size: 3.2em; }
            .task-item { flex-direction: column; align-items: flex-start; gap: 15px; }
            .task-action { width: 100%; flex-direction: row; justify-content: space-between; align-items: center; }
            .telegram-fab { width: 55px; height: 55px; right: 20px; bottom: 105px;}
            .profile-actions-grid { gap: 10px; }
            .action-card { padding: 15px; }
            .action-card i { font-size: 2em; }
            .action-card span { font-size: 0.9em; }
        }
    </style>
</head>
<body>
    <div id="particles-js"></div>
    <div id="background-effects">
        <div class="aurora-background"></div>
    </div>
    <div id="toast-container"></div>

    <!-- Preloader -->
    <div id="preloader"><div class="spinner"></div></div>

    <!-- Authentication Container -->
    <div id="auth-container">
        <div id="login-page-container" class="auth-form">
            <div class="auth-icon"><i class="fas fa-atom"></i></div>
            <div class="content-panel">
                <h2>Welcome Back</h2>
                <form id="login-form">
                    <div class="input-group">
                        <input type="email" id="login-email" required placeholder="Email" autocomplete="email">
                        <i class="fa-solid fa-envelope"></i>
                    </div>
                    <div class="input-group">
                        <input type="password" id="login-password" required placeholder="Password" autocomplete="current-password">
                        <i class="fa-solid fa-lock"></i>
                        <i class="fa-solid fa-eye toggle-password"></i>
                    </div>
                    <button type="submit" class="btn"><span class="btn-text">Login Securely</span><div class="spinner-sm"></div></button>
                </form>
                <p class="auth-switch">No account? <a href="#" id="show-register-link">Sign Up</a></p>
            </div>
        </div>
        <div id="register-page-container" class="auth-form" style="display: none;">
            <div class="auth-icon"><i class="fas fa-user-astronaut"></i></div>
            <div class="content-panel">
                <h2>Create Account</h2>
                <form id="register-form">
                    <div class="input-group">
                        <input type="text" id="register-username" required placeholder="Username" autocomplete="username">
                        <i class="fa-solid fa-user"></i>
                    </div>
                    <div class="input-group">
                        <input type="email" id="register-email" required placeholder="Email" autocomplete="email">
                        <i class="fa-solid fa-envelope"></i>
                    </div>
                    <div class="input-group">
                        <input type="password" id="register-password" required placeholder="Password" autocomplete="new-password">
                        <i class="fa-solid fa-lock"></i>
                        <i class="fa-solid fa-eye toggle-password"></i>
                    </div>
                    <div class="input-group">
                        <input type="password" id="register-repeat-password" required placeholder="Repeat Password" autocomplete="new-password">
                        <i class="fa-solid fa-key"></i>
                    </div>
                    <div class="input-group">
                        <input type="text" id="register-ref-code" placeholder="Invitation Code (Optional)" autocomplete="off">
                        <i class="fa-solid fa-gift"></i>
                    </div>
                    <button type="submit" class="btn"><span class="btn-text">Create My Account</span><div class="spinner-sm"></div></button>
                </form>
                <p class="auth-switch">Have an account? <a href="#" id="show-login-link">Login</a></p>
            </div>
        </div>
    </div>

    <!-- Main Application Container -->
    <div id="app-container">
        <!-- Draggable Floating Telegram Button -->
        <a href="https://t.me/automining009" target="_blank" class="telegram-fab" id="telegram-fab" title="Contact Support on Telegram">
            <i class="fab fa-telegram"></i>
        </a>

        <!-- Home Page -->
        <main id="home-page" class="page">
            <header class="header-welcome">
                <h2 id="welcome-user">Dashboard</h2>
                <p>Manage your investments and grow your holdings.</p>
            </header>
            
            <div class="content-panel" id="mining-hub">
                <h3>Lifetime Mining Engine</h3>
                <div id="mining-hub-idle">
                    <div class="icon"><i class="fas fa-rocket"></i></div>
                    <p>Make a one-time investment to start the mining engine. Your investment is permanent and generates a 3% daily return, paid in CDNC. You can boost your investment anytime.</p>
                    <button class="btn" id="start-mining-modal-btn"><span class="btn-text"><i class="fas fa-play"></i> Start Mining Now</span></button>
                </div>
                <div id="mining-hub-active">
                    <div class="mining-machine-container">
                        <div class="mining-rig"><div class="rig-ring rig-ring-1"></div><div class="rig-ring rig-ring-2"></div><div class="rig-ring rig-ring-3"></div><div class="rig-core"><i class="fas fa-atom"></i></div></div>
                    </div>
                    <div class="mining-stat"><span class="label">Total Investment</span><span class="value" id="mining-investment-value">$0.00</span></div>
                    <div class="mining-stat"><span class="label">Daily Profit Rate</span><span class="value profit" id="mining-profit-rate">0.00 CDNC</span></div>
                    <div class="mining-stat"><span class="label">Accumulated Profit</span><span class="value profit" id="mining-accumulated-profit">0.000000 CDNC</span></div>
                    <div class="mining-actions">
                        <button class="btn btn-boost" id="boost-mining-modal-btn"><span class="btn-text"><i class="fas fa-bolt"></i> Boost Investment</span></button>
                        <button class="btn" id="claim-mining-profit-btn" disabled><span class="btn-text"><i class="fas fa-hand-holding-dollar"></i> Claim Profit</span><div class="spinner-sm"></div></button>
                    </div>
                </div>
            </div>

            <div class="stats-grid">
                <div class="stat-card"><div class="label">CDNC Price</div><div class="value" id="home-coin-price">$....</div></div>
                <div class="stat-card"><div class="label">Your CDNC</div><div class="value" id="home-cdnc-balance">0.00</div></div>
                <div class="stat-card"><div class="label">Your Wallet</div><div class="value" id="home-usd-balance">$0.00</div></div>
                <div class="stat-card"><div class="label">Your Holdings</div><div class="value" id="home-holdings-value">$0.00</div></div>
            </div>
        </main>

        <!-- Trade Page -->
        <section id="trade-page" class="page">
            <div class="content-panel">
                <h3>Your CDNC Holdings</h3>
                <div class="balance-display"><span class="amount" id="trade-cdnc-balance">0.00</span><span class="currency">CDNC</span></div>
            </div>
            <div class="content-panel">
                <h3>Trade CDNC</h3>
                <p class="info-text" style="margin-bottom: 20px;">Price: <b id="trade-coin-price">$....</b> | Available Wallet: <b id="trade-usd-balance">$0.00</b></p>
                <div class="trade-form"><input type="number" id="trade-amount" placeholder="Enter amount of CDNC" min="0"></div>
                <div class="trade-actions">
                    <button class="btn btn-buy" id="buy-btn"><i class="fas fa-arrow-up"></i>&nbsp; <span class="btn-text">Buy</span><div class="spinner-sm"></div></button>
                    <button class="btn btn-sell" id="sell-btn"><i class="fas fa-arrow-down"></i>&nbsp; <span class="btn-text">Sell</span><div class="spinner-sm"></div></button>
                </div>
            </div>
        </section>

        <!-- Stake Page -->
        <section id="stake-page" class="page">
             <div class="content-panel">
                <h3>Stake CDNC & Earn</h3>
                <div class="staking-overview">
                    <div class="staking-stat"><span class="label">Staked Balance</span><span class="value" id="staked-balance-value">0.00</span></div>
                    <div class="staking-stat"><span class="label">Claimable Rewards</span><span class="value" id="staking-rewards-value">0.00</span></div>
                </div>
                <p class="info-text" style="margin-bottom: 25px;">Stake your CDNC to earn a <b>2.8% daily reward</b>. Rewards accumulate and can be claimed at any time. You can unstake your principal at any time.</p>
                <button class="btn btn-claim" id="claim-staking-rewards-btn" style="margin-bottom: 20px;" disabled><span class="btn-text">Claim Rewards</span><div class="spinner-sm"></div></button>

                <form id="stake-form">
                    <div class="input-group"><input type="number" id="stake-amount" placeholder="Amount of CDNC" required min="0.01"><i class="fa-solid fa-coins"></i></div>
                    <div class="trade-actions">
                        <button type="submit" class="btn btn-stake" id="stake-btn"><i class="fas fa-lock"></i>&nbsp; <span class="btn-text">Stake</span><div class="spinner-sm"></div></button>
                        <button type="button" class="btn btn-sell" id="unstake-btn"><i class="fas fa-unlock"></i>&nbsp; <span class="btn-text">Unstake</span><div class="spinner-sm"></div></button>
                    </div>
                </form>
            </div>
        </section>

        <!-- Wallet Page -->
        <section id="wallet-page" class="page">
            <div class="content-panel">
                <h3>My Wallet</h3>
                <div class="balance-display"><span class="amount" id="wallet-usd-balance">$0.00</span><span class="currency">Available USD Balance</span></div>
                <div class="balance-on-hold" id="wallet-on-hold-balance">On Hold: $0.00</div>
                <div class="wallet-actions">
                    <button class="btn btn-buy" id="recharge-btn-modal"><i class="fas fa-plus-circle"></i>&nbsp; Recharge</button>
                    <button class="btn btn-sell" id="withdraw-btn-modal"><i class="fas fa-paper-plane"></i>&nbsp; Withdraw</button>
                </div>
            </div>
            <div class="content-panel">
                <h3>Daily Tasks & Rewards</h3>
                <div class="task-item">
                    <div class="task-info"><h4>Daily Check-in</h4><p class="info-text">Claim a free bonus every 24 hours.</p></div>
                    <div class="task-action"><span class="reward-amount">+ $0.01</span><button class="btn btn-subtle" id="daily-checkin-btn"><span class="btn-text"><i class="fas fa-calendar-check"></i> Check In</span><div class="spinner-sm"></div></button></div>
                </div>
                <div class="task-item">
                    <div class="task-info"><h4>Follow Us on WhatsApp</h4><p class="info-text">Follow our channel for a one-time reward.</p></div>
                    <div class="task-action"><span class="reward-amount">+ $0.001</span><button class="btn btn-subtle" id="whatsapp-follow-btn" data-task-state="follow"><span class="btn-text"><i class="fab fa-whatsapp"></i> Follow</span><div class="spinner-sm"></div></button></div>
                </div>
                <div class="task-item">
                    <div class="task-info"><h4>Invitation Challenge</h4><p class="info-text">Invite 3 users whose first investments total at least $9.</p><div class="task-progress-details"><p id="invite-task-progress-users">Users: 0/3</p><p id="invite-task-progress-investment">Investment: $0.00/$9.00</p></div></div>
                    <div class="task-action"><span class="reward-amount">+ $4.00</span><button class="btn btn-subtle" id="claim-invite-task-btn" disabled><span class="btn-text"><i class="fas fa-trophy"></i> Claim Reward</span><div class="spinner-sm"></div></button></div>
                </div>
            </div>
            <div class="content-panel">
                <h3>Transaction History</h3>
                <ul id="transaction-history-list"><p class="info-text" id="no-transactions-msg">No transactions yet.</p></ul>
            </div>
        </section>

        <!-- [EDITED] Profile Page -->
        <section id="profile-page" class="page">
            <div class="content-panel">
                <div class="profile-header">
                    <div class="profile-avatar"><i class="fas fa-user-astronaut"></i></div>
                    <h2 id="profile-username-display">...</h2>
                    <p id="profile-email-display">...</p>
                </div>
                <div style="margin-bottom: 30px;">
                    <div class="stat-card">
                        <div class="label">User ID</div>
                        <div class="value" id="profile-uid-display" style="font-size: 1.2em; font-family: monospace;">...</div>
                    </div>
                </div>
                <div class="profile-actions-grid">
                    <div class="action-card invite" data-page-target="invite-page"><i class="fas fa-users-rays"></i><span>Invite</span></div>
                    <div class="action-card rewards" data-page-target="rewards-page"><i class="fas fa-trophy"></i><span>Rewards</span></div>
                    <div class="action-card free-mining" data-page-target="free-mining-page"><i class="fas fa-bolt-lightning"></i><span>Free Mining</span></div>
                    <div class="action-card about" data-page-target="about-us-page"><i class="fas fa-info-circle"></i><span>About Us</span></div>
                    <div class="action-card password" data-page-target="security-page"><i class="fas fa-shield-halved"></i><span>Security</span></div>
                    <div class="action-card logout" id="logout-btn"><i class="fas fa-sign-out-alt"></i><span>Logout</span></div>
                </div>
            </div>
        </section>

        <!-- [EDITED] Invite Page -->
        <section id="invite-page" class="page">
            <div class="page-header">
                <button class="back-btn" data-target="profile-page"><i class="fas fa-arrow-left"></i></button>
                <h3>Invitation System</h3>
            </div>
            <div class="content-panel">
                <div class="bonus-display">
                    <div class="label">Unclaimed Bonus Income</div>
                    <div class="amount" id="unclaimed-bonus-amount">$0.00</div>
                </div>
                <button class="btn btn-claim" id="collect-bonus-btn" disabled><span class="btn-text">Collect Income</span><div class="spinner-sm"></div></button>
            </div>
            <div class="content-panel invite-box">
                <div class="icon"><i class="fas fa-paper-plane"></i></div>
                <p>Share your link. You earn <b>10%</b> from your direct referrals' first investment and <b>3%</b> from indirect referrals up to 10 levels deep!</p>
                <div class="invite-code" id="invite-link-display">Generating...</div>
                <button class="btn" id="copy-invite-link-btn"><span class="btn-text"><i class="fas fa-copy"></i>&nbsp; Copy My Link</span></button>
            </div>
            <div class="content-panel">
                <h3>Your Team</h3>
                <div id="referral-levels-list">
                    <!-- JS will populate this -->
                </div>
            </div>
        </section>

        <!-- [NEW] Rewards Page -->
        <section id="rewards-page" class="page">
            <div class="page-header">
                <button class="back-btn" data-target="profile-page"><i class="fas fa-arrow-left"></i></button>
                <h3>Milestone Rewards</h3>
            </div>
            <div class="content-panel">
                <p class="info-text" style="margin-bottom: 25px;">Earn rewards by inviting active users who start their mining engine. Your progress is tracked below.</p>
                <div id="milestone-rewards-list">
                    <!-- JS will populate this -->
                </div>
            </div>
        </section>

        <!-- [NEW] Security Page -->
        <section id="security-page" class="page">
            <div class="page-header">
                <button class="back-btn" data-target="profile-page"><i class="fas fa-arrow-left"></i></button>
                <h3>Security Center</h3>
            </div>
            <div class="content-panel">
                <h3>Change Password</h3>
                <form id="change-password-form">
                    <div class="input-group"><input type="password" id="current-password" placeholder="Current Password" required autocomplete="current-password"><i class="fa-solid fa-key"></i></div>
                    <div class="input-group"><input type="password" id="new-password" placeholder="New Password" required autocomplete="new-password"><i class="fa-solid fa-lock"></i></div>
                    <button type="submit" class="btn"><span class="btn-text">Change Password</span><div class="spinner-sm"></div></button>
                </form>
            </div>
        </section>

        <!-- [NEW] Free Mining Page -->
        <section id="free-mining-page" class="page">
             <div class="page-header">
                <button class="back-btn" data-target="profile-page"><i class="fas fa-arrow-left"></i></button>
                <h3>Gain Free Mining</h3>
            </div>
             <div class="content-panel invite-box">
                <div class="icon" style="color: var(--success-color); text-shadow: 0 0 20px hsla(122, 39%, 49%, 0.5);"><i class="fas fa-gifts"></i></div>
                <h3>Unlock a Permanent Free Mining Engine!</h3>
                <p>As a special reward for our community builders, you can earn a free lifetime mining plan.</p>
                <p><b>Requirement:</b> Invite 5 new users. After each of them has made their first deposit and started their mining engine, you become eligible.</p>
                <div class="stat-card" style="margin: 25px 0;">
                    <div class="label">Your Progress</div>
                    <div class="value" id="free-mining-progress">0 / 5</div>
                    <p class="info-text" style="margin-top: 10px;">Active Referrals</p>
                </div>
                <p>Once your progress bar shows <b>5 / 5</b>, please contact our customer service via the Telegram button to claim your reward. Our team will verify your referrals and activate your free mining plan.</p>
            </div>
        </section>
        
        <!-- [NEW] About Us Page -->
        <section id="about-us-page" class="page">
            <div class="page-header">
                <button class="back-btn" data-target="profile-page"><i class="fas fa-arrow-left"></i></button>
                <h3>About CDNC Coin</h3>
            </div>
            <div class="content-panel">
                <h3>Our Vision: The Future of Decentralized Networks</h3>
                <p class="info-text" style="text-align: left; margin-bottom: 20px;">CDNC Coin (Centralized Decentralized Network Coin) was founded on the principle of bridging the gap between the stability of traditional finance and the limitless potential of blockchain technology. Our mission is to create an accessible, secure, and profitable ecosystem for everyone, from crypto novices to seasoned investors.</p>
                <p class="info-text" style="text-align: left;">We believe in empowering our community through innovative solutions like our Lifetime Mining Engine and Staking protocols. By rewarding users for their participation and loyalty, we are building a robust and self-sustaining digital economy. Join us as we redefine the future of crypto.</p>

                <div class="fbr-certificate">
                    <h4>Federal Board of Revenue</h4>
                    <p><strong>Certificate of Registration</strong></p>
                    <p>This is to certify that</p>
                    <p style="font-weight: bold; font-size: 1.3em;">CDNC CRYPTO-MINING LTD.</p>
                    <p>is registered with the Federal Board of Revenue, under the Companies Act, 2017.</p>
                    <p><strong>Registration Number:</strong> 00198756-2024</p>
                    <p><strong>Date of Incorporation:</strong> JAN 01, 2024</p>
                    <div class="seal"><i class="fas fa-stamp"></i></div>
                    <p style="font-size: 0.8em; margin-top: 10px;">Official Seal - Government of Pakistan</p>
                </div>
            </div>
        </section>

        <!-- Bottom Navigation Bar -->
        <nav class="bottom-nav">
            <button class="nav-btn active" data-page="home-page"><i class="fas fa-home"></i><span>Home</span></button>
            <button class="nav-btn" data-page="trade-page"><i class="fas fa-exchange-alt"></i><span>Trade</span></button>
            <button class="nav-btn" data-page="stake-page"><i class="fas fa-rocket"></i><span>Stake</span></button>
            <button class="nav-btn" data-page="wallet-page"><i class="fas fa-wallet"></i><span>Wallet</span></button>
            <button class="nav-btn" data-page="profile-page"><i class="fas fa-user-circle"></i><span>Profile</span></button>
        </nav>
    </div>

    <!-- Modals -->
    <div id="start-mining-modal" class="modal-overlay">
        <div class="modal-content content-panel"><button class="modal-close-btn" data-modal-id="start-mining-modal">×</button><h3>Start Mining Engine</h3><p class="info-text">Make your first permanent investment to begin generating profit.</p><p class="info-text" style="margin-bottom: 20px;">Available: <b id="mining-modal-usd-balance">$0.00</b></p><form id="start-mining-form"><div class="input-group"><input type="number" id="mining-investment-amount" placeholder="Investment Amount (e.g., 100)" required min="1" max="10000" step="0.01"><i class="fa-solid fa-dollar-sign"></i></div><div class="info-text" style="margin-bottom:20px; text-align: left;"><p>Projected Daily Profit: <b id="mining-modal-profit-preview">0.00 CDNC</b></p></div><button type="submit" class="btn" id="confirm-mining-start-btn"><span class="btn-text">Confirm & Invest</span><div class="spinner-sm"></div></button></form></div>
    </div>
    <div id="boost-mining-modal" class="modal-overlay">
        <div class="modal-content content-panel"><button class="modal-close-btn" data-modal-id="boost-mining-modal">×</button><h3>Boost Mining Investment</h3><p class="info-text">Add more USD to your permanent investment to increase your profit rate.</p><p class="info-text" style="margin-bottom: 5px;">Current Investment: <b id="boost-modal-current-investment">$0.00</b></p><p class="info-text" style="margin-bottom: 20px;">Available to Invest: <b id="boost-modal-usd-balance">$0.00</b></p><form id="boost-mining-form"><div class="input-group"><input type="number" id="boost-investment-amount" placeholder="Additional Amount" required min="1" step="0.01"><i class="fa-solid fa-dollar-sign"></i></div><div class="info-text" style="margin-bottom:20px; text-align: left;"><p>New Total Investment: <b id="boost-modal-new-total">$0.00</b></p><p>New Daily Profit Rate: <b id="boost-modal-profit-preview">0.00 CDNC</b></p></div><button type="submit" class="btn btn-boost" id="confirm-mining-boost-btn"><span class="btn-text">Confirm & Boost</span><div class="spinner-sm"></div></button></form></div>
    </div>
    <div id="recharge-modal" class="modal-overlay">
        <div class="modal-content content-panel"><button class="modal-close-btn" data-modal-id="recharge-modal">×</button><h3>Recharge USD</h3><p class="info-text">Select Network to Deposit USDT. Your deposit will be reviewed by an administrator and credited upon approval.</p><div class="option-group"><button class="option-btn active" data-network="trc20">TRC20</button><button class="option-btn" data-network="bep20">BEP20</button></div><div id="recharge-trc20" class="recharge-details"><p class="info-text">Click box to copy TRC20 address:</p><div class="address-box" data-copy-target-id="trc20-address"><span class="address" id="trc20-address">TKEmWeig1jtWLgPZp4pX4PHAsPsrFNdqf2</span><button class="copy-btn" tabindex="-1"><i class="far fa-copy"></i></button></div></div><div id="recharge-bep20" class="recharge-details" style="display: none;"><p class="info-text">Click box to copy BEP20 address:</p><div class="address-box" data-copy-target-id="bep20-address"><span class="address" id="bep20-address">0xeb0ee64208106984101b1f127cf221358771dbfa</span><button class="copy-btn" tabindex="-1"><i class="far fa-copy"></i></button></div></div><p class="info-text" style="margin-top: 25px;">After sending, paste the amount and transaction ID below.</p><form id="recharge-form"><div class="input-group" style="margin-top: 15px;"><input type="number" id="recharge-amount" placeholder="Amount Sent (USDT)" required min="0.01" step="0.01"></div><div class="input-group"><input type="text" id="transaction-id" placeholder="Transaction ID (TxID)" required></div><button id="submit-recharge-btn" type="submit" class="btn"><span class="btn-text">Submit for Review</span><div class="spinner-sm"></div></button></form></div>
    </div>
    <div id="withdrawal-modal" class="modal-overlay">
        <div class="modal-content content-panel"><button class="modal-close-btn" data-modal-id="withdrawal-modal">×</button><h3>Withdraw USD</h3><form id="withdrawal-form"><div class="input-group"><input type="number" id="withdraw-amount" placeholder="Amount (USD)" required min="0.01" step="0.01"></div><div class="input-group"><select id="withdraw-network" required><option value="">-- Select Network --</option><option value="trc20">USDT (TRC20)</option><option value="bep20">USDT (BEP20)</option></select></div><div class="input-group"><input type="text" id="withdraw-address" placeholder="Your Receiving USDT Address" required></div><button id="submit-withdrawal-btn" type="submit" class="btn"><span class="btn-text">Request Withdrawal</span><div class="spinner-sm"></div></button></form><p class="info-text">A 5% network fee applies. Funds will be held for review and processed by an admin within 24 hours.</p></div>
    </div>
    
    <!-- [NEW] Referral List Modal -->
    <div id="referral-list-modal" class="modal-overlay">
        <div class="modal-content content-panel">
            <button class="modal-close-btn" data-modal-id="referral-list-modal">×</button>
            <h3 id="referral-list-modal-title">Referrals</h3>
            <ul id="referral-list-modal-body" class="transaction-history-list" style="padding-right: 0;">
                <!-- JS will populate this -->
                <p class="info-text">No users found at this level.</p>
            </ul>
        </div>
    </div>

    <!-- Firebase & Particle.js -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const App = {
            // --- [1] CONFIG & INITIALIZATION ---
            config: {
                firebase: {
                    apiKey: "AIzaSyBYHUHqwVWR63hjuYgI1yxKTWTUhNfEwC0",
                    authDomain: "mining-project-62bf5.firebaseapp.com",
                    databaseURL: "https://mining-project-62bf5-default-rtdb.asia-southeast1.firebasedatabase.app/",
                    projectId: "mining-project-62bf5",
                    storageBucket: "mining-project-62bf5.appspot.com",
                    messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
                    appId: "YOUR_APP_ID"
                },
                WITHDRAWAL_FEE_PERCENT: 0.05,
                MIN_WITHDRAWAL_USD: 0,
                PRELOADER_TIMEOUT: 8000,
                // Mining config
                MINING_DAILY_RATE_PERCENT: 0.03, // 3%
                MINING_MIN_INVESTMENT_USD: 1,
                MINING_MAX_INVESTMENT_USD: 10000,
                MINIMUM_PROFIT_CLAIM_CDNC: 0.000001,
                // Staking config
                STAKING_DAILY_RATE_PERCENT: 0.028, // 2.8%
                // Task config
                DAILY_CHECKIN_REWARD_USD: 0.01,
                WHATSAPP_FOLLOW_REWARD_USD: 0.001,
                WHATSAPP_CHANNEL_URL: 'https://whatsapp.com/channel/0029Vb6P72rJP21BwMdVP946',
                INVITE_TASK_REQUIRED_USERS: 3,
                INVITE_TASK_REQUIRED_INVESTMENT_USD: 9,
                INVITE_TASK_REWARD_USD: 4,
                // [NEW] Invitation System Config
                REFERRAL_LEVELS: 10,
                REFERRAL_DIRECT_BONUS_PERCENT: 0.10, // 10%
                REFERRAL_INDIRECT_BONUS_PERCENT: 0.03, // 3%
                // [NEW] Milestone Rewards Config
                MILESTONE_REWARDS: [
                    { requiredUsers: 2, rewardUSD: 1.00 },
                    { requiredUsers: 4, rewardUSD: 1.00 },
                    { requiredUsers: 6, rewardUSD: 2.00 },
                    { requiredUsers: 8, rewardUSD: 2.00 },
                    { requiredUsers: 10, rewardUSD: 3.00 },
                ]
            },

            // --- [2] STATE MANAGEMENT ---
            state: {
                currentUser: null,
                userData: null,
                coinPrice: 0, 
                userRef: null,
                txRef: null,
                invitesRef: null,
                preloaderTimeoutId: null,
                miningProfitInterval: null,
                stakingRewardInterval: null,
                ui: {},
            },

            async init() {
                this.cacheDOMElements();
                this.initFirebase();
                this.initDraggableFAB();
                this.listenToAppConfig();
                this.initParticles();
                this.bindEventListeners();
                this.handleAuth();
                this.state.preloaderTimeoutId = setTimeout(() => this.hidePreloader(), this.config.PRELOADER_TIMEOUT);
                this.checkForRefCode();
            },

            initFirebase() {
                try {
                    if (!firebase.apps.length) { firebase.initializeApp(this.config.firebase); }
                    this.auth = firebase.auth();
                    this.db = firebase.database();
                } catch (error) {
                    console.error("Firebase initialization failed:", error);
                    this.showToast('Application failed to load.', 'danger');
                }
            },
            
            listenToAppConfig() {
                this.db.ref('appConfig').on('value', (snapshot) => {
                    const configData = snapshot.val();
                    if (configData && configData.coinPrice) {
                        this.state.coinPrice = Number(configData.coinPrice);
                    } else {
                        this.state.coinPrice = 0;
                        console.warn("Coin price not found in Firebase. Defaulting to 0.");
                    }
                    if (this.state.userData) { this.updateUI(); }
                });
            },

            initParticles() {
                if (typeof particlesJS !== 'undefined') {
                    particlesJS('particles-js', {"particles":{"number":{"value":50,"density":{"enable":true,"value_area":800}},"color":{"value":"#4dd0e1"},"shape":{"type":"circle"},"opacity":{"value":0.6,"random":true,"anim":{"enable":true,"speed":1,"opacity_min":0.1}},"size":{"value":2,"random":true},"line_linked":{"enable":true,"distance":150,"color":"#4dd0e1","opacity":0.15,"width":1},"move":{"enable":true,"speed":1,"direction":"none","random":true,"straight":false,"out_mode":"out"}},"interactivity":{"detect_on":"canvas","events":{"onhover":{"enable":true,"mode":"grab"},"onclick":{"enable":true,"mode":"push"}},"modes":{"grab":{"distance":140,"line_linked":{"opacity":0.2}},"push":{"particles_nb":4}}},"retina_detect":true});
                }
            },
            
            // --- [3] UI / DOM MANIPULATION ---
            cacheDOMElements() {
                this.state.ui = {
                    preloader: document.getElementById('preloader'), authContainer: document.getElementById('auth-container'), appContainer: document.getElementById('app-container'), toastContainer: document.getElementById('toast-container'), telegramFab: document.getElementById('telegram-fab'),
                    loginPage: document.getElementById('login-page-container'), registerPage: document.getElementById('register-page-container'), loginForm: document.getElementById('login-form'), registerForm: document.getElementById('register-form'), registerRefCodeInput: document.getElementById('register-ref-code'),
                    welcomeUser: document.getElementById('welcome-user'), homeCoinPrice: document.getElementById('home-coin-price'), homeUsdBalance: document.getElementById('home-usd-balance'), homeCdncBalance: document.getElementById('home-cdnc-balance'), homeHoldingsValue: document.getElementById('home-holdings-value'),
                    miningHubIdle: document.getElementById('mining-hub-idle'), miningHubActive: document.getElementById('mining-hub-active'), miningInvestmentValue: document.getElementById('mining-investment-value'), miningProfitRate: document.getElementById('mining-profit-rate'), miningAccumulatedProfit: document.getElementById('mining-accumulated-profit'), claimMiningProfitBtn: document.getElementById('claim-mining-profit-btn'), startMiningForm: document.getElementById('start-mining-form'), miningModalUsdBalance: document.getElementById('mining-modal-usd-balance'), miningInvestmentAmountInput: document.getElementById('mining-investment-amount'), miningModalProfitPreview: document.getElementById('mining-modal-profit-preview'), boostMiningModalBtn: document.getElementById('boost-mining-modal-btn'), boostMiningForm: document.getElementById('boost-mining-form'), boostModalCurrentInvestment: document.getElementById('boost-modal-current-investment'), boostModalUsdBalance: document.getElementById('boost-modal-usd-balance'), boostInvestmentAmountInput: document.getElementById('boost-investment-amount'), boostModalNewTotal: document.getElementById('boost-modal-new-total'), boostModalProfitPreview: document.getElementById('boost-modal-profit-preview'),
                    tradeCoinPrice: document.getElementById('trade-coin-price'), tradeUsdBalance: document.getElementById('trade-usd-balance'), tradeCdncBalance: document.getElementById('trade-cdnc-balance'),
                    walletUsdBalance: document.getElementById('wallet-usd-balance'), walletOnHoldBalance: document.getElementById('wallet-on-hold-balance'), rechargeForm: document.getElementById('recharge-form'), withdrawalForm: document.getElementById('withdrawal-form'), transactionList: document.getElementById('transaction-history-list'), noTransactionsMsg: document.getElementById('no-transactions-msg'),
                    stakedBalanceValue: document.getElementById('staked-balance-value'), stakingRewardsValue: document.getElementById('staking-rewards-value'), stakeForm: document.getElementById('stake-form'), stakeAmountInput: document.getElementById('stake-amount'), unstakeBtn: document.getElementById('unstake-btn'), claimStakingRewardsBtn: document.getElementById('claim-staking-rewards-btn'),
                    profileUsernameDisplay: document.getElementById('profile-username-display'), profileEmailDisplay: document.getElementById('profile-email-display'), profileUidDisplay: document.getElementById('profile-uid-display'),
                    changePasswordForm: document.getElementById('change-password-form'),
                    inviteLinkDisplay: document.getElementById('invite-link-display'),
                    dailyCheckinBtn: document.getElementById('daily-checkin-btn'), whatsappFollowBtn: document.getElementById('whatsapp-follow-btn'),
                    inviteTaskProgressUsers: document.getElementById('invite-task-progress-users'), inviteTaskProgressInvestment: document.getElementById('invite-task-progress-investment'), claimInviteTaskBtn: document.getElementById('claim-invite-task-btn'),
                    unclaimedBonusAmount: document.getElementById('unclaimed-bonus-amount'), collectBonusBtn: document.getElementById('collect-bonus-btn'), referralLevelsList: document.getElementById('referral-levels-list'),
                    milestoneRewardsList: document.getElementById('milestone-rewards-list'),
                    freeMiningProgress: document.getElementById('free-mining-progress'),
                    referralListModal: document.getElementById('referral-list-modal'), referralListModalTitle: document.getElementById('referral-list-modal-title'), referralListModalBody: document.getElementById('referral-list-modal-body'),
                };
            },
            
            showPage(pageId) { document.querySelectorAll('.page').forEach(p => p.classList.remove('active')); document.getElementById(pageId)?.classList.add('active'); document.querySelectorAll('.nav-btn').forEach(b => b.classList.toggle('active', ['home-page', 'trade-page', 'stake-page', 'wallet-page', 'profile-page'].includes(pageId) && b.dataset.page === pageId)); window.scrollTo(0, 0); },
            showModal(modalId) { document.getElementById(modalId)?.classList.add('active'); },
            hideModal(modalId) { document.getElementById(modalId)?.classList.remove('active'); },
            showToast(message, type = 'success') { const toast = document.createElement('div'); toast.className = `toast ${type}`; toast.textContent = message; this.state.ui.toastContainer.appendChild(toast); setTimeout(() => toast.remove(), 4000); },
            hidePreloader() { if (this.state.preloaderTimeoutId) clearTimeout(this.state.preloaderTimeoutId); this.state.ui.preloader.classList.add('hidden'); },
            setButtonLoading(btn, isLoading) { if (btn) { btn.classList.toggle('loading', isLoading); btn.disabled = isLoading; } },
            
            updateUI() {
                if (!this.state.userData) return;
                const { username, email, uid, referralCode, usd_balance = 0, cdnc_balance = 0, balance_on_hold = 0 } = this.state.userData;
                const formatCurrency = (num) => `$${Number(num || 0).toFixed(2)}`;
                const formatToken = (num, digits=4) => Number(num || 0).toFixed(digits);
                
                // Common UI elements
                this.state.ui.welcomeUser.textContent = `Welcome, ${username || email.split('@')[0]}`;
                const coinPriceText = this.state.coinPrice > 0 ? formatCurrency(this.state.coinPrice) : '$....';
                [this.state.ui.homeCoinPrice, this.state.ui.tradeCoinPrice].forEach(el => el.innerText = coinPriceText);
                
                // Balances
                const stakedAmount = this.state.userData.staking?.stakedAmountCDNC || 0;
                const holdingsValue = (cdnc_balance + stakedAmount) * this.state.coinPrice;
                this.state.ui.homeUsdBalance.textContent = formatCurrency(usd_balance);
                this.state.ui.homeCdncBalance.textContent = formatToken(cdnc_balance, 2);
                this.state.ui.tradeCdncBalance.textContent = formatToken(cdnc_balance, 2);
                this.state.ui.walletUsdBalance.textContent = formatCurrency(usd_balance);
                this.state.ui.walletOnHoldBalance.textContent = `On Hold: ${formatCurrency(balance_on_hold)}`;
                this.state.ui.homeHoldingsValue.innerText = formatCurrency(holdingsValue);
                this.state.ui.tradeUsdBalance.innerText = formatCurrency(usd_balance);
                
                // Profile Page
                this.state.ui.profileUsernameDisplay.textContent = username || 'Not Set';
                this.state.ui.profileEmailDisplay.textContent = email;
                this.state.ui.profileUidDisplay.textContent = uid;
                
                // Invite Page
                this.state.ui.inviteLinkDisplay.innerText = `${window.location.origin}${window.location.pathname}?ref=${referralCode}`;
                
                // Update component-specific UIs
                this.updateMiningUI();
                this.updateStakingUI();
                this.updateTasksUI();
                this.updateInviteUI();
                this.updateRewardsUI();
                this.updateFreeMiningUI();
            },

            updateTransactionHistory(transactions) {
                this.state.ui.transactionList.innerHTML = '';
                if (!transactions || Object.keys(transactions).length === 0) {
                    this.state.ui.noTransactionsMsg.style.display = 'block';
                    return;
                }
                this.state.ui.noTransactionsMsg.style.display = 'none';
                const sortedTxs = Object.values(transactions).sort((a, b) => b.timestamp - a.timestamp);
                sortedTxs.forEach(tx => {
                    const item = document.createElement('li');
                    const isPending = tx.details?.status === 'pending';
                    item.className = `transaction-item ${tx.type.toLowerCase()} ${isPending ? 'pending' : ''}`;
                    const icons = { buy: 'fa-cart-plus', sell: 'fa-hand-holding-dollar', deposit: 'fa-arrow-down', withdrawal: 'fa-paper-plane', bonus: 'fa-gift', mining_profit: 'fa-pickaxe', mining_invest: 'fa-bolt', stake: 'fa-lock', unstake: 'fa-unlock', stake_reward: 'fa-star', invite_bonus: 'fa-users' };
                    let amountDisplay;
                    if (['deposit', 'withdrawal', 'mining_invest', 'bonus', 'invite_bonus'].includes(tx.type)) {
                        amountDisplay = `${tx.type.startsWith('mining') ? '-' : '+'}$${Number(tx.amount).toFixed(4)}`;
                    } else {
                        amountDisplay = `${Number(tx.amount).toFixed(4)} CDNC`;
                    }
                    const typeDisplay = isPending ? `${tx.type.replace(/_/g, ' ')} (Pending)` : (tx.details?.reason || tx.type.replace(/_/g, ' '));
                    item.innerHTML = `<div class="icon"><i class="fas ${icons[tx.type.toLowerCase()] || 'fa-exchange-alt'}"></i></div><div class="details"><div class="type">${typeDisplay}</div><div class="date">${new Date(tx.timestamp).toLocaleString()}</div></div><div class="amount">${amountDisplay}</div>`;
                    this.state.ui.transactionList.appendChild(item);
                });
            },
            
            // --- [4] EVENT LISTENERS & HANDLERS ---
            bindEventListeners() {
                // Auth
                document.getElementById('show-register-link').addEventListener('click', (e) => { e.preventDefault(); this.state.ui.loginPage.style.display = 'none'; this.state.ui.registerPage.style.display = 'block'; });
                document.getElementById('show-login-link').addEventListener('click', (e) => { e.preventDefault(); this.state.ui.registerPage.style.display = 'none'; this.state.ui.loginPage.style.display = 'block'; });
                this.state.ui.loginForm.addEventListener('submit', (e) => this.handleLogin(e));
                this.state.ui.registerForm.addEventListener('submit', (e) => this.handleRegister(e));
                document.querySelectorAll('.toggle-password').forEach(toggle => { toggle.addEventListener('click', (e) => { const icon = e.target; const input = icon.closest('.input-group')?.querySelector('input'); if(input) { input.type = input.type === 'password' ? 'text' : 'password'; icon.className = `fa-solid ${input.type === 'password' ? 'fa-eye' : 'fa-eye-slash'} toggle-password`; } }); });
                
                // Navigation
                document.querySelectorAll('.nav-btn').forEach(btn => btn.addEventListener('click', () => this.showPage(btn.dataset.page)));
                document.querySelectorAll('.action-card').forEach(card => { if(card.dataset.pageTarget) { card.addEventListener('click', () => this.showPage(card.dataset.pageTarget)); } });
                document.querySelectorAll('.back-btn').forEach(btn => btn.addEventListener('click', () => this.showPage(btn.dataset.target)));
                document.getElementById('logout-btn')?.addEventListener('click', (e) => this.handleLogout(e));

                // Modals
                document.querySelectorAll('.modal-close-btn').forEach(btn => btn.addEventListener('click', () => this.hideModal(btn.dataset.modalId)));
                document.getElementById('recharge-btn-modal').addEventListener('click', () => this.showModal('recharge-modal'));
                document.getElementById('withdraw-btn-modal').addEventListener('click', () => this.showModal('withdrawal-modal'));
                
                // Core Features
                document.getElementById('buy-btn').addEventListener('click', (e) => this.handleTrade('buy', e));
                document.getElementById('sell-btn').addEventListener('click', (e) => this.handleTrade('sell', e));
                this.state.ui.rechargeForm.addEventListener('submit', (e) => this.handleRecharge(e));
                this.state.ui.withdrawalForm.addEventListener('submit', (e) => this.handleWithdraw(e));
                this.state.ui.startMiningForm.addEventListener('submit', (e) => this.handleStartMining(e));
                this.state.ui.boostMiningForm.addEventListener('submit', (e) => this.handleBoostMining(e));
                this.state.ui.stakeForm.addEventListener('submit', (e) => this.handleStake(e));
                this.state.ui.unstakeBtn.addEventListener('click', (e) => this.handleUnstake(e));

                // Buttons and Inputs
                document.getElementById('start-mining-modal-btn').addEventListener('click', () => this.openStartMiningModal());
                this.state.ui.miningInvestmentAmountInput.addEventListener('input', () => this.updateMiningProfitPreview());
                this.state.ui.claimMiningProfitBtn.addEventListener('click', (e) => this.handleClaimMiningProfit(e));
                this.state.ui.boostMiningModalBtn.addEventListener('click', () => this.openBoostMiningModal());
                this.state.ui.boostInvestmentAmountInput.addEventListener('input', () => this.updateBoostProfitPreview());
                this.state.ui.claimStakingRewardsBtn.addEventListener('click', e => this.handleClaimStakingRewards(e));
                this.state.ui.changePasswordForm.addEventListener('submit', e => this.handleChangePassword(e));
                document.getElementById('copy-invite-link-btn').addEventListener('click', (e) => this.copyToClipboard(this.state.ui.inviteLinkDisplay.innerText, e.currentTarget));
                document.querySelectorAll('.address-box').forEach(box => { box.addEventListener('click', (e) => { e.preventDefault(); const targetId = box.dataset.copyTargetId; const textToCopy = document.getElementById(targetId)?.innerText; if (textToCopy) this.copyToClipboard(textToCopy, box); }); });
                document.querySelectorAll('#recharge-modal .option-btn').forEach(btn => { btn.addEventListener('click', () => { document.querySelectorAll('#recharge-modal .option-btn').forEach(b => b.classList.remove('active')); btn.classList.add('active'); const network = btn.dataset.network; document.getElementById('recharge-trc20').style.display = network === 'trc20' ? 'block' : 'none'; document.getElementById('recharge-bep20').style.display = network === 'bep20' ? 'block' : 'none'; }); });

                // Tasks & Rewards
                this.state.ui.dailyCheckinBtn.addEventListener('click', e => this.handleDailyCheckin(e));
                this.state.ui.whatsappFollowBtn.addEventListener('click', e => this.handleWhatsAppTask(e));
                this.state.ui.claimInviteTaskBtn.addEventListener('click', e => this.handleClaimInviteTask(e));
                this.state.ui.collectBonusBtn.addEventListener('click', e => this.handleCollectInviteBonus(e));

                // [NEW] Invite Level Click Listener
                this.state.ui.referralLevelsList.addEventListener('click', e => this.handleLevelClick(e));
            },
            
            checkForRefCode() { const refCode = new URLSearchParams(window.location.search).get('ref'); if (refCode) { this.state.ui.registerRefCodeInput.value = refCode; } },
            
            // --- [5] CORE LOGIC ---
            handleAuth() { this.auth.onAuthStateChanged(user => { this.hidePreloader(); if (user) { this.state.currentUser = user; this.listenToUserData(); this.state.ui.authContainer.classList.remove('active'); this.state.ui.appContainer.classList.add('active'); this.showPage('home-page'); } else { this.state.currentUser = null; this.state.userData = null; this.stopAllListeners(); this.state.ui.authContainer.classList.add('active'); this.state.ui.appContainer.classList.remove('active'); } }); },
            
            async handleRegister(e) {
                e.preventDefault();
                const btn = e.target.querySelector('button');
                this.setButtonLoading(btn, true);
                const username = document.getElementById('register-username').value.trim();
                const email = document.getElementById('register-email').value.trim();
                const password = document.getElementById('register-password').value;
                const repeatPassword = document.getElementById('register-repeat-password').value;
                const refCode = this.state.ui.registerRefCodeInput.value.trim();

                if (password !== repeatPassword) { this.showToast('Passwords do not match.', 'danger'); this.setButtonLoading(btn, false); return; }
                if (password.length < 6) { this.showToast('Password should be at least 6 characters.', 'danger'); this.setButtonLoading(btn, false); return; }

                try {
                    let referrerData = null;
                    let ancestry = {};
                    if(refCode) {
                        const referrerSnap = await this.db.ref('users').orderByChild('referralCode').equalTo(refCode).once('value');
                        if (referrerSnap.exists()) {
                            const referrerUid = Object.keys(referrerSnap.val())[0];
                            referrerData = referrerSnap.val()[referrerUid];
                            ancestry['level_1'] = referrerUid;
                            if(referrerData.ancestry){
                                for(let i = 1; i < this.config.REFERRAL_LEVELS; i++){
                                    if(referrerData.ancestry[`level_${i}`]){
                                        ancestry[`level_${i + 1}`] = referrerData.ancestry[`level_${i}`];
                                    } else { break; }
                                }
                            }
                        } else { this.showToast('Invalid invitation code.', 'warning'); }
                    }

                    const userCredential = await this.auth.createUserWithEmailAndPassword(email, password);
                    const user = userCredential.user;
                    const referralCode = 'CDNC' + Math.random().toString(36).substring(2, 8).toUpperCase();
                    
                    await this.db.ref('users/' + user.uid).set({
                        username, email, uid: user.uid, referralCode, referredBy: refCode || null,
                        usd_balance: 0, cdnc_balance: 0, balance_on_hold: 0,
                        unclaimed_invite_bonus: 0, active_referrals_count: 0,
                        mining: { totalInvestmentUSD: 0, lastProfitClaimTimestamp: 0, firstInvestmentProcessed: false },
                        staking: { stakedAmountCDNC: 0, lastRewardTimestamp: 0, claimableRewards: 0 },
                        lastCheckinTimestamp: 0, hasFollowedWhatsApp: false,
                        invitationTaskProgress: { invitedUsersCount: 0, totalInvestmentFromInvites: 0, investedUserUIDs: {} },
                        invitationTaskRewardClaimed: false,
                        milestoneRewardsClaimed: {},
                        ancestry: ancestry,
                        referrals_by_level: {},
                        referrals_data: {} // For storing detailed referral info
                    });

                    if(Object.keys(ancestry).length > 0){
                        const updates = {};
                        for (const [level, ancestorUid] of Object.entries(ancestry)) {
                            const levelNum = parseInt(level.split('_')[1]);
                            updates[`${ancestorUid}/referrals_by_level/level_${levelNum}`] = firebase.database.ServerValue.increment(1);
                            // [EDIT] Also add detailed user info for the new interactive list
                            updates[`${ancestorUid}/referrals_data/level_${levelNum}/${user.uid}`] = { username, email, joinedAt: firebase.database.ServerValue.TIMESTAMP };
                        }
                        await this.db.ref('users').update(updates);
                    }
                    
                    await user.updateProfile({ displayName: username });
                    this.showToast('Registration successful! Please log in.', 'success');
                    this.state.ui.registerForm.reset();
                    this.state.ui.registerPage.style.display = 'none';
                    this.state.ui.loginPage.style.display = 'block';
                } catch (error) { this.showToast(error.message, 'danger');
                } finally { this.setButtonLoading(btn, false); }
            },

            async handleLogin(e) { e.preventDefault(); const btn = e.target.querySelector('button'); this.setButtonLoading(btn, true); const email = document.getElementById('login-email').value; const password = document.getElementById('login-password').value; try { await this.auth.signInWithEmailAndPassword(email, password); } catch (error) { this.showToast(error.message, 'danger'); } finally { this.setButtonLoading(btn, false); } },
            async handleLogout(e) { try { await this.auth.signOut(); } catch (error) { this.showToast(error.message, 'danger'); } },
            async handleTrade(type, e) { const btn = e.currentTarget; if (this.state.coinPrice <= 0) return this.showToast('Trade is disabled.', 'danger'); const amount = parseFloat(document.getElementById('trade-amount').value); if (isNaN(amount) || amount <= 0) { return this.showToast('Please enter a valid amount.', 'danger'); } this.setButtonLoading(btn, true); const { usd_balance, cdnc_balance } = this.state.userData; try { if (type === 'buy') { const cost = amount * this.state.coinPrice; if (usd_balance < cost) throw new Error('Insufficient USD balance.'); await this.state.userRef.update({ usd_balance: firebase.database.ServerValue.increment(-cost), cdnc_balance: firebase.database.ServerValue.increment(amount) }); await this.logTransaction('buy', amount, { price: this.state.coinPrice }); this.showToast(`Successfully bought ${amount.toFixed(4)} CDNC!`, 'success'); } else { if (cdnc_balance < amount) throw new Error('Insufficient CDNC balance.'); const gain = amount * this.state.coinPrice; await this.state.userRef.update({ usd_balance: firebase.database.ServerValue.increment(gain), cdnc_balance: firebase.database.ServerValue.increment(-amount) }); await this.logTransaction('sell', amount, { price: this.state.coinPrice }); this.showToast(`Successfully sold ${amount.toFixed(4)} CDNC!`, 'success'); } document.getElementById('trade-amount').value = ''; } catch (err) { this.showToast(err.message, 'danger'); } finally { this.setButtonLoading(btn, false); } },
            async handleRecharge(e) { e.preventDefault(); const btn = e.currentTarget.querySelector('button'); const amount = parseFloat(document.getElementById('recharge-amount').value); const txId = document.getElementById('transaction-id').value.trim(); if (!txId || isNaN(amount) || amount <= 0) return this.showToast('Please provide valid amount and TxID.', 'danger'); this.setButtonLoading(btn, true); const network = document.querySelector('#recharge-modal .option-btn.active').dataset.network; try { await this.db.ref('recharge_requests').push({ userId: this.state.currentUser.uid, userEmail: this.state.currentUser.email, amount, network, txId, status: 'pending', timestamp: firebase.database.ServerValue.TIMESTAMP }); await this.logTransaction('deposit', amount, { network, txId, status: 'pending' }); this.showToast(`Recharge request for $${amount.toFixed(2)} submitted!`, 'success'); this.state.ui.rechargeForm.reset(); this.hideModal('recharge-modal'); } catch (err) { this.showToast(`Request failed: ${err.message}`, 'danger'); } finally { this.setButtonLoading(btn, false); } },
            async handleWithdraw(e) { e.preventDefault(); const btn = e.currentTarget.querySelector('button'); const amount = parseFloat(document.getElementById('withdraw-amount').value); const address = document.getElementById('withdraw-address').value.trim(); const network = document.getElementById('withdraw-network').value; if (isNaN(amount) || amount <= 0 || !address || !network) return this.showToast('Please fill all fields.', 'danger'); if (this.state.userData.usd_balance < amount) return this.showToast(`Insufficient balance.`, 'danger'); this.setButtonLoading(btn, true); const fee = amount * this.config.WITHDRAWAL_FEE_PERCENT; try { await this.state.userRef.update({ usd_balance: firebase.database.ServerValue.increment(-amount), balance_on_hold: firebase.database.ServerValue.increment(amount) }); await this.db.ref('withdrawal_requests').push({ userId: this.state.currentUser.uid, userEmail: this.state.currentUser.email, amount, fee, address, network, status: 'pending', timestamp: firebase.database.ServerValue.TIMESTAMP }); await this.logTransaction('withdrawal', amount, { network, address, fee, status: 'pending' }); this.showToast('Withdrawal request submitted!', 'success'); this.state.ui.withdrawalForm.reset(); this.hideModal('withdrawal-modal'); } catch (err) { this.showToast(`Withdrawal failed: ${err.message}`, 'danger'); await this.state.userRef.update({ usd_balance: firebase.database.ServerValue.increment(amount), balance_on_hold: firebase.database.ServerValue.increment(-amount) }); } finally { this.setButtonLoading(btn, false); } },
            
            // --- [5.1] Mining & Invitation Bonus Logic ---
            openStartMiningModal() { if (!this.state.userData) return; this.state.ui.miningModalUsdBalance.textContent = `$${(this.state.userData.usd_balance || 0).toFixed(2)}`; this.state.ui.miningInvestmentAmountInput.value = ''; this.updateMiningProfitPreview(); this.showModal('start-mining-modal'); },
            updateMiningProfitPreview() { if (this.state.coinPrice <= 0) { this.state.ui.miningModalProfitPreview.textContent = '... CDNC'; return; } const amount = parseFloat(this.state.ui.miningInvestmentAmountInput.value) || 0; const profitCDNC = (amount * this.config.MINING_DAILY_RATE_PERCENT) / this.state.coinPrice; this.state.ui.miningModalProfitPreview.textContent = `${profitCDNC.toFixed(4)} CDNC`; },
            async handleStartMining(e) {
                e.preventDefault();
                const btn = e.target.querySelector('button');
                const amount = parseFloat(this.state.ui.miningInvestmentAmountInput.value);
                if (isNaN(amount) || amount < this.config.MINING_MIN_INVESTMENT_USD || amount > this.config.MINING_MAX_INVESTMENT_USD) { return this.showToast(`Investment must be between $${this.config.MINING_MIN_INVESTMENT_USD} and $${this.config.MINING_MAX_INVESTMENT_USD}.`, 'danger'); }
                if (amount > this.state.userData.usd_balance) { return this.showToast('Insufficient USD balance.', 'danger'); }
                
                this.setButtonLoading(btn, true);
                try {
                    if (!this.state.userData.mining?.totalInvestmentUSD || this.state.userData.mining.totalInvestmentUSD === 0) {
                        await this.processFirstInvestmentAndReferrals(amount);
                    }
                    await this.state.userRef.update({ 
                        'usd_balance': firebase.database.ServerValue.increment(-amount), 
                        'mining/totalInvestmentUSD': amount,
                        'mining/lastProfitClaimTimestamp': firebase.database.ServerValue.TIMESTAMP
                    });
                    await this.logTransaction('mining_invest', amount, { reason: `Initial investment of $${amount}` });
                    this.showToast(`Mining started with $${amount.toFixed(2)}!`, 'success');
                    this.hideModal('start-mining-modal');
                } catch (error) {
                    this.showToast(`Error: ${error.message}`, 'danger');
                } finally {
                    this.setButtonLoading(btn, false);
                }
            },
            async processFirstInvestmentAndReferrals(investmentAmount) {
                if (this.state.userData.mining.firstInvestmentProcessed) return;
                const { ancestry } = this.state.userData;
                if (!ancestry || Object.keys(ancestry).length === 0) {
                    await this.state.userRef.child('mining').update({ firstInvestmentProcessed: true });
                    return;
                }
                const updates = {};
                for (const [level, ancestorUid] of Object.entries(ancestry)) {
                    const levelNum = parseInt(level.split('_')[1]);
                    const bonusPercent = levelNum === 1 ? this.config.REFERRAL_DIRECT_BONUS_PERCENT : this.config.REFERRAL_INDIRECT_BONUS_PERCENT;
                    const bonusAmount = investmentAmount * bonusPercent;
                    updates[`${ancestorUid}/unclaimed_invite_bonus`] = firebase.database.ServerValue.increment(bonusAmount);
                }
                const directReferrerUid = ancestry['level_1'];
                if(directReferrerUid){
                    updates[`${directReferrerUid}/active_referrals_count`] = firebase.database.ServerValue.increment(1);
                }
                updates[`${this.state.currentUser.uid}/mining/firstInvestmentProcessed`] = true;
                await this.db.ref('users').update(updates);
            },
            openBoostMiningModal() { if (!this.state.userData?.mining) return; this.state.ui.boostModalCurrentInvestment.textContent = `$${(this.state.userData.mining.totalInvestmentUSD || 0).toFixed(2)}`; this.state.ui.boostModalUsdBalance.textContent = `$${(this.state.userData.usd_balance || 0).toFixed(2)}`; this.state.ui.boostInvestmentAmountInput.value = ''; this.updateBoostProfitPreview(); this.showModal('boost-mining-modal'); },
            updateBoostProfitPreview() { if (this.state.coinPrice <= 0) { this.state.ui.boostModalProfitPreview.textContent = '... CDNC'; return; } const newTotal = (this.state.userData?.mining?.totalInvestmentUSD || 0) + (parseFloat(this.state.ui.boostInvestmentAmountInput.value) || 0); const profitCDNC = (newTotal * this.config.MINING_DAILY_RATE_PERCENT) / this.state.coinPrice; this.state.ui.boostModalNewTotal.textContent = `$${newTotal.toFixed(2)}`; this.state.ui.boostModalProfitPreview.textContent = `${profitCDNC.toFixed(4)} CDNC`; },
            async handleBoostMining(e) { e.preventDefault(); const btn = e.target.querySelector('button'); const boostAmount = parseFloat(this.state.ui.boostInvestmentAmountInput.value); if (isNaN(boostAmount) || boostAmount <= 0) return this.showToast(`Please enter a valid amount.`, 'danger'); if (boostAmount > this.state.userData.usd_balance) return this.showToast('Insufficient USD balance.', 'danger'); this.setButtonLoading(btn, true); try { await this.state.userRef.update({ usd_balance: firebase.database.ServerValue.increment(-boostAmount), 'mining/totalInvestmentUSD': firebase.database.ServerValue.increment(boostAmount) }); await this.logTransaction('mining_invest', boostAmount, { reason: `Boosted by $${boostAmount}`}); this.showToast(`Boosted investment by $${boostAmount.toFixed(2)}!`, 'success'); this.hideModal('boost-mining-modal'); } catch (error) { this.showToast(`Error: ${error.message}`, 'danger'); } finally { this.setButtonLoading(btn, false); } },
            async handleClaimMiningProfit(e) { const btn = e.currentTarget; const profitCDNC = this.calculateMiningProfit(); if (profitCDNC < this.config.MINIMUM_PROFIT_CLAIM_CDNC) { return this.showToast("Profit is too low to claim.", "info"); } this.setButtonLoading(btn, true); try { await this.state.userRef.transaction(data => { if (data) { data.cdnc_balance = (data.cdnc_balance || 0) + this.calculateMiningProfit(data.mining); data.mining.lastProfitClaimTimestamp = firebase.database.ServerValue.TIMESTAMP; } return data; }); await this.logTransaction('mining_profit', profitCDNC); this.showToast(`Claimed ${profitCDNC.toFixed(6)} CDNC!`, 'success'); } catch(error) { this.showToast(`Error: ${error.message}`, 'danger'); } finally { this.setButtonLoading(btn, false); } },
            calculateMiningProfit(miningData = this.state.userData.mining) { if (!miningData?.totalInvestmentUSD || !miningData.lastProfitClaimTimestamp || this.state.coinPrice <= 0) return 0; const elapsedMs = Date.now() - miningData.lastProfitClaimTimestamp; if (elapsedMs <= 0) return 0; const profitPerDayCDNC = (miningData.totalInvestmentUSD * this.config.MINING_DAILY_RATE_PERCENT) / this.state.coinPrice; return (elapsedMs / 86400000) * profitPerDayCDNC; },
            updateMiningUI() { if(this.state.miningProfitInterval) clearInterval(this.state.miningProfitInterval); const miningData = this.state.userData?.mining; if (miningData && miningData.totalInvestmentUSD > 0) { this.state.ui.miningHubIdle.style.display = 'none'; this.state.ui.miningHubActive.style.display = 'block'; const investment = miningData.totalInvestmentUSD; this.state.ui.miningInvestmentValue.textContent = `$${investment.toFixed(2)}`; if (this.state.coinPrice > 0) { this.state.ui.miningProfitRate.textContent = `${((investment * this.config.MINING_DAILY_RATE_PERCENT) / this.state.coinPrice).toFixed(4)} CDNC`; } else { this.state.ui.miningProfitRate.textContent = '... CDNC'; } this.state.miningProfitInterval = setInterval(() => { const accumulatedProfit = this.calculateMiningProfit(); this.state.ui.miningAccumulatedProfit.textContent = `${accumulatedProfit.toFixed(8)} CDNC`; this.state.ui.claimMiningProfitBtn.disabled = accumulatedProfit < this.config.MINIMUM_PROFIT_CLAIM_CDNC; }, 1000); } else { this.state.ui.miningHubIdle.style.display = 'block'; this.state.ui.miningHubActive.style.display = 'none'; } },

            // --- [5.2] Staking Logic ---
            updateStakingUI() { const stakingData = this.state.userData?.staking || {}; if(this.state.stakingRewardInterval) clearInterval(this.state.stakingRewardInterval); this.state.ui.stakedBalanceValue.textContent = (stakingData.stakedAmountCDNC || 0).toFixed(4); this.state.stakingRewardInterval = setInterval(() => { const stakedAmount = stakingData.stakedAmountCDNC || 0; if (stakedAmount > 0) { const newReward = ((Date.now() - (stakingData.lastRewardTimestamp || Date.now())) / 86400000) * (stakedAmount * this.config.STAKING_DAILY_RATE_PERCENT); const totalClaimable = (stakingData.claimableRewards || 0) + newReward; this.state.ui.stakingRewardsValue.textContent = totalClaimable.toFixed(8); this.state.ui.claimStakingRewardsBtn.disabled = totalClaimable < 0.00000001; } else { this.state.ui.stakingRewardsValue.textContent = '0.00000000'; this.state.ui.claimStakingRewardsBtn.disabled = true; } }, 1000); },
            async handleClaimStakingRewards(e) { const btn = e.currentTarget; this.setButtonLoading(btn, true); const stakingData = this.state.userData.staking; const stakedAmount = stakingData.stakedAmountCDNC || 0; const lastTime = stakingData.lastRewardTimestamp || Date.now(); const newReward = ((Date.now() - lastTime) / 86400000) * (stakedAmount * this.config.STAKING_DAILY_RATE_PERCENT); const totalClaimable = (stakingData.claimableRewards || 0) + newReward; if (totalClaimable <= 0) { this.setButtonLoading(btn, false); return this.showToast("No rewards to claim.", "info"); } try { await this.state.userRef.child('staking').update({ lastRewardTimestamp: firebase.database.ServerValue.TIMESTAMP, claimableRewards: 0 }); await this.state.userRef.update({ cdnc_balance: firebase.database.ServerValue.increment(totalClaimable) }); await this.logTransaction('stake_reward', totalClaimable); this.showToast(`Claimed ${totalClaimable.toFixed(8)} CDNC!`, 'success'); } catch (error) { this.showToast(`Claim failed: ${error.message}`, 'danger'); } finally { this.setButtonLoading(btn, false); } },
            async handleStake(e) { e.preventDefault(); const btn = e.target.querySelector('#stake-btn'); const amount = parseFloat(this.state.ui.stakeAmountInput.value); if (isNaN(amount) || amount <= 0) return this.showToast('Enter a valid amount.', 'danger'); if (amount > (this.state.userData.cdnc_balance || 0)) return this.showToast('Insufficient CDNC balance.', 'danger'); this.setButtonLoading(btn, true); try { await this.handleClaimStakingRewards({ currentTarget: this.state.ui.claimStakingRewardsBtn }); await this.state.userRef.transaction(d => { if (d) { d.cdnc_balance = (d.cdnc_balance || 0) - amount; if (!d.staking) d.staking = {}; d.staking.stakedAmountCDNC = (d.staking.stakedAmountCDNC || 0) + amount; d.staking.lastRewardTimestamp = firebase.database.ServerValue.TIMESTAMP; } return d; }); await this.logTransaction('stake', amount); this.showToast(`Staked ${amount.toFixed(4)} CDNC!`, 'success'); this.state.ui.stakeAmountInput.value = ''; } catch (error) { this.showToast(`Staking failed: ${error.message}`, 'danger'); } finally { this.setButtonLoading(btn, false); } },
            async handleUnstake(e) { const btn = e.currentTarget; const amount = parseFloat(this.state.ui.stakeAmountInput.value); const stakedAmount = this.state.userData?.staking?.stakedAmountCDNC || 0; if (isNaN(amount) || amount <= 0) return this.showToast('Enter a valid amount.', 'danger'); if (amount > stakedAmount) return this.showToast('Amount exceeds staked balance.', 'danger'); this.setButtonLoading(btn, true); try { await this.handleClaimStakingRewards({ currentTarget: this.state.ui.claimStakingRewardsBtn }); await this.state.userRef.transaction(d => { if (d?.staking) { d.cdnc_balance = (d.cdnc_balance || 0) + amount; d.staking.stakedAmountCDNC -= amount; d.staking.lastRewardTimestamp = firebase.database.ServerValue.TIMESTAMP; } return d; }); await this.logTransaction('unstake', amount); this.showToast(`Unstaked ${amount.toFixed(4)} CDNC!`, 'success'); this.state.ui.stakeAmountInput.value = ''; } catch (error) { this.showToast(`Unstaking failed: ${error.message}`, 'danger'); } finally { this.setButtonLoading(btn, false); } },
            
            // --- [5.3] Profile, Tasks, Rewards & Invite Logic ---
            updateTasksUI() { if (!this.state.userData) return; const { lastCheckinTimestamp = 0, hasFollowedWhatsApp = false } = this.state.userData; const now = new Date(); const isSameDay = new Date(lastCheckinTimestamp).toDateString() === now.toDateString(); this.state.ui.dailyCheckinBtn.disabled = isSameDay; this.state.ui.dailyCheckinBtn.querySelector('.btn-text').innerHTML = isSameDay ? `<i class="fas fa-check"></i> Claimed` : `<i class="fas fa-calendar-check"></i> Check In`; if (hasFollowedWhatsApp) { this.state.ui.whatsappFollowBtn.disabled = true; this.state.ui.whatsappFollowBtn.querySelector('.btn-text').innerHTML = `<i class="fas fa-check"></i> Claimed`; } const progress = this.state.userData.invitationTaskProgress || {}; const rewardClaimed = this.state.userData.invitationTaskRewardClaimed; this.state.ui.inviteTaskProgressUsers.textContent = `Users: ${progress.invitedUsersCount || 0}/${this.config.INVITE_TASK_REQUIRED_USERS}`; this.state.ui.inviteTaskProgressInvestment.textContent = `Investment: $${(progress.totalInvestmentFromInvites || 0).toFixed(2)}/$${this.config.INVITE_TASK_REQUIRED_INVESTMENT_USD.toFixed(2)}`; if (rewardClaimed) { this.state.ui.claimInviteTaskBtn.disabled = true; this.state.ui.claimInviteTaskBtn.querySelector('.btn-text').innerHTML = `<i class="fas fa-check"></i> Claimed`; } else { this.state.ui.claimInviteTaskBtn.disabled = !(progress.invitedUsersCount >= this.config.INVITE_TASK_REQUIRED_USERS && progress.totalInvestmentFromInvites >= this.config.INVITE_TASK_REQUIRED_INVESTMENT_USD); } },
            async handleDailyCheckin(e) { if (new Date(this.state.userData.lastCheckinTimestamp || 0).toDateString() === new Date().toDateString()) return this.showToast('Already claimed today.', 'info'); this.setButtonLoading(e.currentTarget, true); try { await this.state.userRef.update({ usd_balance: firebase.database.ServerValue.increment(this.config.DAILY_CHECKIN_REWARD_USD), lastCheckinTimestamp: firebase.database.ServerValue.TIMESTAMP }); await this.logTransaction('bonus', this.config.DAILY_CHECKIN_REWARD_USD, { reason: 'Daily Check-in' }); this.showToast(`Received $${this.config.DAILY_CHECKIN_REWARD_USD.toFixed(2)}!`, 'success'); } catch (error) { this.showToast(error.message, 'danger'); } finally { this.setButtonLoading(e.currentTarget, false); } },
            async handleWhatsAppTask(e) { const btn = e.currentTarget; const state = btn.dataset.taskState; if (state === 'follow') { window.open(this.config.WHATSAPP_CHANNEL_URL, '_blank'); btn.querySelector('.btn-text').innerHTML = `<i class="fas fa-hand-holding-dollar"></i> Claim Reward`; btn.dataset.taskState = 'claim'; } else if (state === 'claim') { if (this.state.userData.hasFollowedWhatsApp) return this.showToast('Already claimed.', 'info'); this.setButtonLoading(btn, true); try { await this.state.userRef.update({ usd_balance: firebase.database.ServerValue.increment(this.config.WHATSAPP_FOLLOW_REWARD_USD), hasFollowedWhatsApp: true }); await this.logTransaction('bonus', this.config.WHATSAPP_FOLLOW_REWARD_USD, { reason: 'WhatsApp Follow' }); this.showToast(`Received $${this.config.WHATSAPP_FOLLOW_REWARD_USD.toFixed(3)}!`, 'success'); } catch (error) { this.showToast(error.message, 'danger'); this.setButtonLoading(btn, false); } } },
            async handleClaimInviteTask(e) { const btn = e.currentTarget; this.setButtonLoading(btn, true); if (this.state.userData.invitationTaskRewardClaimed) { this.showToast('Already claimed.', 'info'); this.setButtonLoading(btn, false); return; } try { await this.state.userRef.update({ usd_balance: firebase.database.ServerValue.increment(this.config.INVITE_TASK_REWARD_USD), invitationTaskRewardClaimed: true }); await this.logTransaction('bonus', this.config.INVITE_TASK_REWARD_USD, { reason: 'Invitation Task' }); this.showToast(`You've earned $${this.config.INVITE_TASK_REWARD_USD.toFixed(2)}!`, 'success'); } catch (error) { this.showToast(error.message, 'danger'); } finally { this.setButtonLoading(btn, false); } },
            async handleChangePassword(e) { e.preventDefault(); const btn = e.target.querySelector('button'); this.setButtonLoading(btn, true); const currentPassword = document.getElementById('current-password').value; const newPassword = document.getElementById('new-password').value; if (newPassword.length < 6) { this.showToast('New password must be at least 6 characters.', 'danger'); this.setButtonLoading(btn, false); return; } try { const user = this.state.currentUser; await user.reauthenticateWithCredential(firebase.auth.EmailAuthProvider.credential(user.email, currentPassword)); await user.updatePassword(newPassword); this.showToast('Password changed successfully!', 'success'); this.state.ui.changePasswordForm.reset(); this.showPage('profile-page'); } catch (error) { this.showToast(error.message, 'danger'); } finally { this.setButtonLoading(btn, false); } },
            async logTransaction(type, amount, details = {}) { if(!this.state.currentUser) return; await this.db.ref(`transactions/${this.state.currentUser.uid}`).push({ type, amount, details, timestamp: firebase.database.ServerValue.TIMESTAMP }); },

            // [EDITED] Invite Page Logic
            updateInviteUI() {
                const unclaimedBonus = this.state.userData.unclaimed_invite_bonus || 0;
                this.state.ui.unclaimedBonusAmount.textContent = `$${unclaimedBonus.toFixed(4)}`;
                this.state.ui.collectBonusBtn.disabled = unclaimedBonus <= 0;
                const levels = this.state.userData.referrals_by_level || {};
                this.state.ui.referralLevelsList.innerHTML = '';
                for(let i = 1; i <= this.config.REFERRAL_LEVELS; i++) {
                    const count = levels[`level_${i}`] || 0;
                    const percent = i === 1 ? this.config.REFERRAL_DIRECT_BONUS_PERCENT * 100 : this.config.REFERRAL_INDIRECT_BONUS_PERCENT * 100;
                    const item = document.createElement('div');
                    item.className = 'level-item';
                    item.dataset.level = i;
                    item.innerHTML = `
                        <div class="level-name">Level ${i} <span class="percent">(${percent}%)</span></div>
                        <div class="level-count">${count} Users <i class="fas fa-chevron-right" style="margin-left: 10px; color: var(--text-secondary);"></i></div>
                    `;
                    this.state.ui.referralLevelsList.appendChild(item);
                }
            },
            async handleCollectInviteBonus(e) {
                const btn = e.currentTarget;
                const unclaimedBonus = this.state.userData.unclaimed_invite_bonus || 0;
                if (unclaimedBonus <= 0) return;
                this.setButtonLoading(btn, true);
                try {
                    await this.state.userRef.update({
                        usd_balance: firebase.database.ServerValue.increment(unclaimedBonus),
                        unclaimed_invite_bonus: 0
                    });
                    await this.logTransaction('invite_bonus', unclaimedBonus, { reason: 'Team Commission' });
                    this.showToast(`Collected $${unclaimedBonus.toFixed(4)} from your team!`, 'success');
                } catch (error) {
                    this.showToast(`Error: ${error.message}`, 'danger');
                } finally {
                    this.setButtonLoading(btn, false);
                }
            },
            async handleLevelClick(e) {
                const levelItem = e.target.closest('.level-item');
                if (!levelItem) return;
                const levelNum = levelItem.dataset.level;
                if (!levelNum) return;
                this.state.ui.referralListModalTitle.textContent = `Level ${levelNum} Referrals`;
                this.state.ui.referralListModalBody.innerHTML = '<div class="spinner" style="margin: 20px auto;"></div>'; // Show loader
                this.showModal('referral-list-modal');
                try {
                    const snapshot = await this.db.ref(`users/${this.state.currentUser.uid}/referrals_data/level_${levelNum}`).once('value');
                    const referrals = snapshot.val();
                    this.state.ui.referralListModalBody.innerHTML = ''; // Clear loader
                    if (referrals && Object.keys(referrals).length > 0) {
                        Object.values(referrals).forEach(user => {
                            const userItem = document.createElement('li');
                            userItem.className = 'transaction-item';
                            userItem.style.borderLeftColor = 'var(--secondary-accent)';
                            const username = user.username || 'N/A';
                            const email = user.email ? this.maskEmail(user.email) : 'N/A';
                            userItem.innerHTML = `
                                <div class="icon" style="color: var(--secondary-accent);"><i class="fas fa-user"></i></div>
                                <div class="details">
                                    <div class="type">${username}</div>
                                    <div class="date">${email}</div>
                                </div>
                            `;
                            this.state.ui.referralListModalBody.appendChild(userItem);
                        });
                    } else {
                        this.state.ui.referralListModalBody.innerHTML = '<p class="info-text">No users found at this level.</p>';
                    }
                } catch (error) {
                    console.error("Error fetching referral data:", error);
                    this.state.ui.referralListModalBody.innerHTML = '<p class="info-text">Could not load data.</p>';
                    this.showToast('Failed to load referral data.', 'danger');
                }
            },
            // [NEW] Rewards Page Logic
            updateRewardsUI() {
                const { active_referrals_count = 0, milestoneRewardsClaimed = {} } = this.state.userData;
                this.state.ui.milestoneRewardsList.innerHTML = '';
                this.config.MILESTONE_REWARDS.forEach((milestone, index) => {
                    const isClaimed = milestoneRewardsClaimed[milestone.requiredUsers];
                    const isClaimable = !isClaimed && active_referrals_count >= milestone.requiredUsers;
                    let stateClass = '';
                    let buttonHtml = `<button class="btn btn-subtle" disabled>Locked</button>`;
                    if (isClaimed) {
                        stateClass = 'claimed';
                        buttonHtml = `<button class="btn btn-subtle" disabled><i class="fas fa-check"></i> Claimed</button>`;
                    } else if (isClaimable) {
                        stateClass = 'claimable';
                        buttonHtml = `<button class="btn" onclick="App.handleClaimMilestoneReward(${milestone.requiredUsers}, ${milestone.rewardUSD})">Claim</button>`;
                    }
                    
                    const item = document.createElement('div');
                    item.className = `reward-item ${stateClass}`;
                    item.innerHTML = `
                        <div class="reward-info">
                            <h4>Invite ${milestone.requiredUsers} Active Users</h4>
                            <p>Progress: ${Math.min(active_referrals_count, milestone.requiredUsers)} / ${milestone.requiredUsers}</p>
                        </div>
                        <div class="reward-action">
                            <div class="reward-value">+$${milestone.rewardUSD.toFixed(2)}</div>
                            ${buttonHtml}
                        </div>`;
                    this.state.ui.milestoneRewardsList.appendChild(item);
                });
            },
            async handleClaimMilestoneReward(requiredUsers, rewardUSD) {
                if (this.state.userData.milestoneRewardsClaimed[requiredUsers]) {
                    return this.showToast("Reward already claimed.", "info");
                }
                try {
                    await this.state.userRef.update({
                        usd_balance: firebase.database.ServerValue.increment(rewardUSD),
                        [`milestoneRewardsClaimed/${requiredUsers}`]: true
                    });
                    await this.logTransaction('bonus', rewardUSD, { reason: `Milestone: ${requiredUsers} active referrals` });
                    this.showToast(`Claimed $${rewardUSD.toFixed(2)} reward!`, 'success');
                } catch (error) {
                    this.showToast(`Error: ${error.message}`, 'danger');
                }
            },
             // [NEW] Free Mining Page Logic
            updateFreeMiningUI() {
                const activeReferrals = this.state.userData.active_referrals_count || 0;
                this.state.ui.freeMiningProgress.textContent = `${activeReferrals} / 5`;
            },

            // --- [6] DATA LISTENERS ---
            listenToUserData() { if (!this.state.currentUser || this.state.userRef) return; this.state.userRef = this.db.ref('users/' + this.state.currentUser.uid); this.state.txRef = this.db.ref('transactions/' + this.state.currentUser.uid); this.state.userRef.on('value', (snapshot) => { this.hidePreloader(); this.state.userData = snapshot.val(); if (this.state.userData) { this.updateUI(); } else { this.auth.signOut(); } }, (error) => { console.error("Firebase user data error:", error); this.showToast("Could not sync user data.", "danger"); }); this.state.txRef.limitToLast(50).on('value', (snapshot) => this.updateTransactionHistory(snapshot.val())); },
            stopAllListeners() { if (this.state.userRef) this.state.userRef.off(); if (this.state.txRef) this.state.txRef.off(); if(this.state.miningProfitInterval) clearInterval(this.state.miningProfitInterval); if(this.state.stakingRewardInterval) clearInterval(this.state.stakingRewardInterval); this.state.userRef = null; this.state.txRef = null; },

            // --- [7] HELPERS ---
            copyToClipboard(textToCopy, elementToUpdate = null) { if (!textToCopy) return; navigator.clipboard.writeText(textToCopy).then(() => { this.showToast('Copied!', 'success'); if (elementToUpdate) { const originalHTML = elementToUpdate.innerHTML; if(elementToUpdate.classList.contains('address-box')) { const icon = elementToUpdate.querySelector('.copy-btn i'); const originalIconClass = icon.className; elementToUpdate.classList.add('copied'); icon.className = 'fas fa-check'; setTimeout(() => { elementToUpdate.classList.remove('copied'); icon.className = originalIconClass; }, 2500); } else { elementToUpdate.innerHTML = `<span class="btn-text"><i class="fas fa-check"></i> Copied!</span>`; elementToUpdate.disabled = true; setTimeout(() => { elementToUpdate.innerHTML = originalHTML; elementToUpdate.disabled = false; }, 2000); } } }).catch(() => this.showToast('Failed to copy.', 'danger')); },
            initDraggableFAB() { const fab = this.state.ui.telegramFab; if (!fab) return; let isDragging = false, hasMoved = false, offsetX, offsetY; const getCoords = e => e.touches ? e.touches[0] : e; const start = e => { isDragging = true; hasMoved = false; fab.classList.add('dragging'); const c = getCoords(e); offsetX = c.clientX - fab.offsetLeft; offsetY = c.clientY - fab.offsetTop; document.addEventListener('mousemove', move); document.addEventListener('touchmove', move, { passive: false }); document.addEventListener('mouseup', end); document.addEventListener('touchend', end); }; const move = e => { if (!isDragging) return; e.preventDefault(); hasMoved = true; const c = getCoords(e); fab.style.left = `${Math.max(0, Math.min(c.clientX - offsetX, window.innerWidth - fab.offsetWidth))}px`; fab.style.top = `${Math.max(0, Math.min(c.clientY - offsetY, window.innerHeight - fab.offsetHeight))}px`; fab.style.right = 'auto'; fab.style.bottom = 'auto'; }; const end = () => { isDragging = false; fab.classList.remove('dragging'); document.removeEventListener('mousemove', move); document.removeEventListener('touchmove', move); document.removeEventListener('mouseup', end); document.removeEventListener('touchend', end); }; fab.addEventListener('mousedown', start); fab.addEventListener('touchstart', start); fab.addEventListener('click', e => { if (hasMoved) e.preventDefault(); }); },
            maskEmail(email) {
                if (!email || email.indexOf('@') === -1) return email;
                const [name, domain] = email.split('@');
                if (name.length <= 2) return `${name.slice(0, 1)}***@${domain}`;
                return `${name.slice(0, 2)}***@${domain}`;
            },
        };

        // Make the App object globally accessible for inline onclick handlers
        window.App = App;
        App.init();
    });
    </script>
</body>
</html>
